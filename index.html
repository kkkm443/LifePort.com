<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3182F6">
    <title>LifePort - MyData MVP</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        /* í™”ë©´ ê½‰ ì°¨ê²Œ ì„¤ì • ë° ì¤‘ì•™ ì •ë ¬ */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        body { font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        #root { height: 100%; display: flex; justify-content: center; align-items: center; }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #ffffff; border: 2px solid #3182F6;
            box-shadow: 0 2px 6px rgba(49, 130, 246, 0.4); margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; border-radius: 4px;
        }
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-group label { display: block; font-size: 13px; color: #6b7280; margin-bottom: 6px; font-weight: 600; }
        .input-group input, .input-group select { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e5e7eb; 
            font-size: 16px; font-weight: 500; color: #1f2937; outline: none; transition: all 0.2s;
            background-color: #fff;
        }
        .input-group input:focus, .input-group select:focus { border-color: #3182F6; ring: 2px solid #3182F6; }

        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ */
        .custom-checkbox {
            width: 24px; height: 24px; border-radius: 50%; border: 2px solid #ddd;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .custom-checkbox.checked { border-color: #3182F6; background-color: #3182F6; }
    </style>
</head>
<body class="bg-[#F2F4F6]">
    <div id="root"></div>

    <script type="text/babel">
        // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
        const Icon = ({ d, size=20, color="currentColor", className="" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>
        );
        const Icons = {
            User: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8",
            Alert: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01",
            Shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
            Refresh: "M23 4v6h-6 M1 20v-6h6 M3.51 9a9 9 0 0 1 14.85-3.36L23 10 M1 14l4.64 4.36A9 9 0 0 0 20.49 15",
            Bank: "M3 22h18 M6 18v-7 M10 18v-7 M14 18v-7 M18 18v-7 M12 2l8 5H4z",
            Card: "M1 4h22v16H1z M1 10h22",
            Graph: "M23 6l-9.5 9.5-5-5L1 18",
            Activity: "M22 12h-4l-3 9L9 3l-3 9H2",
            ArrowRight: "M5 12h14 M12 5l7 7-7 7",
            Bell: "M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9 M13.73 21a2 2 0 0 1-3.46 0",
            Link: "M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",
            Check: "M20 6L9 17l-5-5",
            X: "M18 6L6 18M6 6l12 12",
            Coffee: "M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8zM6 1v3M10 1v3M14 1v3",
            Shopping: "M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4zM3 6h18M16 10a4 4 0 0 1-8 0",
            Game: "M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
        };

        // --- [ë§ˆì´ë°ì´í„° MVPìš© ê°€ìƒ ë°ì´í„° ë° ë¡œì§] ---
        const mockAccounts = [
            { id: 1, bank: 'KBêµ­ë¯¼', name: 'ONEí†µì¥-ì €ì¶•ì˜ˆê¸ˆ', balance: 4500000, icon: 'ğŸŸ¡' },
            { id: 2, bank: 'ìš°ë¦¬', name: 'WON í†µì¥', balance: 2100000, icon: 'ğŸ”µ' },
            { id: 3, bank: 'ì¹´ì¹´ì˜¤ë±…í¬', name: 'ì…ì¶œê¸ˆí†µì¥', balance: 850000, icon: 'ğŸŸ¡' },
            { id: 4, bank: 'í† ìŠ¤ë±…í¬', name: 'í† ìŠ¤ë±…í¬ í†µì¥', balance: 3200000, icon: 'ğŸ”µ' },
            { id: 5, bank: 'ì‹ í•œ', name: 'ì í¸í•œ ì…ì¶œê¸ˆ', balance: 1500000, icon: 'ğŸ”µ' }
        ];

        const habitCategories = {
            'cafe': { title: 'ì¹´í˜/ë””ì €íŠ¸ ëŸ¬ë²„', icon: Icons.Coffee, color: 'text-brown-500', bg: 'bg-brown-50' },
            'delivery': { title: 'ë°°ë‹¬ìŒì‹ ë§¤ë‹ˆì•„', icon: Icons.Shopping, color: 'text-red-500', bg: 'bg-red-50' },
            'shopping': { title: 'ì˜¨ë¼ì¸ ì‡¼í¼í™€ë¦­', icon: Icons.Shopping, color: 'text-purple-500', bg: 'bg-purple-50' },
            'game': { title: 'ê²œì£¼ë‹˜(ê²Œì„/ì·¨ë¯¸)', icon: Icons.Game, color: 'text-indigo-500', bg: 'bg-indigo-50' },
        };

        // ê°€ìƒ íŠ¸ëœì­ì…˜ ë¶„ì„ê¸°
        const analyzeMockTransactions = (selectedIds) => {
            // ì„ íƒëœ ê³„ì¢Œì˜ ì´ ìì‚° ê³„ì‚°
            const totalAssetsFound = mockAccounts
                .filter(acc => selectedIds.includes(acc.id))
                .reduce((sum, acc) => sum + acc.balance, 0);

            // ê°€ìƒì˜ ì†Œë¹„ íŒ¨í„´ ëœë¤ ìƒì„± (ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜)
            const habits = Object.keys(habitCategories);
            const randomHabitKey = habits[Math.floor(Math.random() * habits.length)];
            
            // ê°€ìƒì˜ ì›” í‰ê·  ì§€ì¶œ (ìì‚° ê·œëª¨ì— ë¹„ë¡€í•˜ì—¬ ëŒ€ëµ ê³„ì‚°)
            let estimatedMonthlyExpense = Math.round((totalAssetsFound * (Math.random() * 0.05 + 0.03)) / 10000) * 10000; 
            if (estimatedMonthlyExpense < 1000000) estimatedMonthlyExpense = 1000000 + Math.round(Math.random()*50)*10000;

            return {
                totalAssets: Math.round(totalAssetsFound / 10000), // ë§Œì› ë‹¨ìœ„
                monthlyExpense: Math.round(estimatedMonthlyExpense / 10000), // ë§Œì› ë‹¨ìœ„
                habit: randomHabitKey
            };
        };
        // -------------------------------------------


        const LifePortSimulator = () => {
            const [screen, setScreen] = React.useState('intro'); 
            const [loadingStep, setLoadingStep] = React.useState(0);
            
            const [inputData, setInputData] = React.useState({
                age: 30, jobType: 'office', monthlyIncome: 300, totalAssets: '', monthlyExpense: ''
            });

            // --- ë§ˆì´ë°ì´í„° ê´€ë ¨ State ---
            const [myDataStep, setMyDataStep] = React.useState('select'); // select, connecting, analyzing, complete
            const [selectedAccounts, setSelectedAccounts] = React.useState([]);
            const [analyzedData, setAnalyzedData] = React.useState(null);
            // ---------------------------

            const [profile, setProfile] = React.useState(null);
            const [simulationResult, setSimulationResult] = React.useState(null);
            const [lifestyle, setLifestyle] = React.useState('standard'); 
            const [activeRisks, setActiveRisks] = React.useState({}); 
            const [savings, setSavings] = React.useState(0); 
            const [isSubscribed, setIsSubscribed] = React.useState(false);

            // ì§ì—…ë³„ ê¸°ë³¸ ì„¸íŒ…
            const jobTraits = {
                office: { title: 'ì§ì¥ì¸', retirementAge: 60, investMin: 2, investMax: 4 },
                free: { title: 'í”„ë¦¬ëœì„œ', retirementAge: 65, investMin: 2, investMax: 5 },
                civil: { title: 'ê³µë¬´ì›', retirementAge: 60, investMin: 1.5, investMax: 3 },
                startup: { title: 'ì°½ì—…/ì‚¬ì—…ê°€', retirementAge: 65, investMin: 1, investMax: 6 },
                pro: { title: 'ì „ë¬¸ì§', retirementAge: 68, investMin: 2.5, investMax: 5.5 }
            };

            // ë¦¬ìŠ¤í¬ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
            const riskScenarios = {
                20: [{ id: 'marriage', title: 'ğŸ’ ê²°í˜¼/ë…ë¦½ ì¤€ë¹„', loss: 8000, prob: '70%', period: 3 }, { id: 'car', title: 'ğŸš— ì°¨ëŸ‰ í• ë¶€ êµ¬ë§¤', loss: 3000, prob: '60%', period: 2 }],
                30: [{ id: 'housing', title: 'ğŸ  ì£¼íƒ ëŒ€ì¶œ ì´ì', loss: 10000, prob: '50%', period: 20 }, { id: 'child', title: 'ğŸ‘¶ ìœ¡ì•„ ë¹„ìš©', loss: 4000, prob: '40%', period: 5 }],
                40: [{ id: 'education', title: 'ğŸ“ ìë…€ êµìœ¡ë¹„', loss: 12000, prob: '80%', period: 8 }, { id: 'medical', title: 'ğŸ¥ ê°€ì¡± ì˜ë£Œë¹„', loss: 5000, prob: '24%' }],
                50: [{ id: 'business', title: 'ğŸ“‰ íˆ¬ì/ì‚¬ì—… ì†ì‹¤', loss: 15000, prob: '30%' }, { id: 'job', title: 'ğŸ’¼ ì¡°ê¸° í‡´ì§', loss: 5000, prob: '15%' }],
                60: [{ id: 'health', title: 'ğŸ¥ ë…¸í›„ ì˜ë£Œë¹„', loss: 8000, prob: '35%', period: 10 }, { id: 'scam', title: 'ğŸ’¸ ì‚¬ê¸°/ë¶„ìŸ', loss: 10000, prob: '15%' }]
            };

            const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const formatMoney = (val) => val >= 10000 ? (val/10000).toFixed(1).replace('.0','') + 'ì–µ' : val.toLocaleString() + 'ë§Œì›';

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                if (name === 'jobType') {
                    setInputData(prev => ({ ...prev, [name]: value }));
                } else {
                    setInputData(prev => ({ ...prev, [name]: value === '' ? '' : Number(value) }));
                }
            };

            // --- ë§ˆì´ë°ì´í„° ì—°ë™ ë¡œì§ ---
            const startMyDataFlow = () => {
                setScreen('mydata');
                setMyDataStep('select');
                setSelectedAccounts([]);
                setAnalyzedData(null);
            };

            const toggleAccountSelection = (id) => {
                setSelectedAccounts(prev => 
                    prev.includes(id) ? prev.filter(accId => accId !== id) : [...prev, id]
                );
            };

            const proceedToConnection = () => {
                if (selectedAccounts.length === 0) return;
                setMyDataStep('connecting');
                // ì—°ê²° ì‹œë®¬ë ˆì´ì…˜ (1.5ì´ˆ)
                setTimeout(() => {
                    setMyDataStep('analyzing');
                    // ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜ (2ì´ˆ) ë° ê²°ê³¼ ë„ì¶œ
                    setTimeout(() => {
                        const result = analyzeMockTransactions(selectedAccounts);
                        setAnalyzedData(result);
                        setMyDataStep('complete');
                    }, 2000);
                }, 1500);
            };

            const applyMyDataResult = () => {
                if (analyzedData) {
                    setInputData(prev => ({
                        ...prev,
                        totalAssets: analyzedData.totalAssets,
                        monthlyExpense: analyzedData.monthlyExpense
                    }));
                    // í”„ë¡œí•„ ìƒì„± ì‹œ ì†Œë¹„ ìŠµê´€ ì •ë³´ë„ í•¨ê»˜ ì €ì¥
                    setProfile(prev => ({...createProfileFromInput(), habit: analyzedData.habit}));
                }
                setScreen('input');
            };
            // ---------------------------


            const createProfileFromInput = () => {
                const trait = jobTraits[inputData.jobType];
                const safeInput = {
                    age: Number(inputData.age) || 30,
                    monthlyIncome: Number(inputData.monthlyIncome) || 0,
                    monthlyExpense: Number(inputData.monthlyExpense) || 0,
                    totalAssets: Number(inputData.totalAssets) || 0
                };
                const ageKey = Math.floor(safeInput.age/10)*10;
                const safeAgeKey = (ageKey > 60) ? 60 : (ageKey < 20 ? 20 : ageKey);

                return {
                    age: safeInput.age, job: trait.title, monthlyIncome: safeInput.monthlyIncome, baseMonthlyExpense: safeInput.monthlyExpense,
                    totalAssets: safeInput.totalAssets, totalDebt: 0, 
                    risks: riskScenarios[safeAgeKey] || riskScenarios[40],
                    retirementAge: trait.retirementAge, investmentReturn: rand(trait.investMin * 10, trait.investMax * 10) / 10,
                    habit: analyzedData ? analyzedData.habit : null // ë§ˆì´ë°ì´í„° ë¶„ì„ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ìŠµê´€ ì €ì¥
                };
            };

            // ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ (ì´ì „ê³¼ ë™ì¼)
            const runSimulation = () => {
                if (!profile) return;
                const INFLATION_RATE = 0.03; const INCOME_GROWTH_RATE = 0.03; const TAX_RATE = 0.154;
                let assets = profile.totalAssets; let isBankrupt = false; let bankruptAge = 100;
                let lifestyleMult = lifestyle === 'basic' ? 0.85 : (lifestyle === 'rich' ? 1.2 : 1.0);
                const isEarlyRetired = activeRisks['job'];
                const effectiveRetirementAge = isEarlyRetired ? profile.age : profile.retirementAge;

                Object.keys(activeRisks).forEach(id => { 
                    if(activeRisks[id]) {
                        const risk = profile.risks.find(r=>r.id===id);
                        if (!risk.period) assets -= risk.loss; 
                    }
                });

                for (let age = profile.age; age <= 100; age++) {
                    const yearIndex = age - profile.age;
                    let yearlyIncome = 0;
                    if (age <= effectiveRetirementAge) {
                        yearlyIncome = (profile.monthlyIncome * 12) * Math.pow(1 + INCOME_GROWTH_RATE, yearIndex);
                    } else {
                        const basePension = Math.min(profile.monthlyIncome * 0.4, 200);
                        yearlyIncome = (basePension * 12) * Math.pow(1 + INFLATION_RATE, yearIndex);
                    }

                    let currentBaseExpense = (profile.baseMonthlyExpense * lifestyleMult);
                    let currentAdditionalSavings = savings * Math.pow(1 + INFLATION_RATE, yearIndex); 
                    let realMonthlyExpense = currentBaseExpense - currentAdditionalSavings;
                    let minLivingBase = (60 * lifestyleMult) + (age - 30) * 0.5; 
                    let minLivingInflated = minLivingBase * Math.pow(1 + INFLATION_RATE, yearIndex);
                    if (realMonthlyExpense < minLivingInflated) realMonthlyExpense = minLivingInflated;

                    let annualExp = realMonthlyExpense * 12 * Math.pow(1 + INFLATION_RATE, yearIndex);
                    Object.keys(activeRisks).forEach(id => {
                        if(activeRisks[id]) {
                            const risk = profile.risks.find(r=>r.id===id);
                            if (risk.period && age < profile.age + risk.period) {
                                annualExp += (risk.loss / risk.period) * Math.pow(1 + INFLATION_RATE, yearIndex);
                            }
                        }
                    });

                    let rawReturnRate = (age <= effectiveRetirementAge) ? profile.investmentReturn : (profile.investmentReturn * 0.7);
                    let investmentGain = (assets > 0) ? assets * (rawReturnRate / 100) * (1 - TAX_RATE) : 0;
                    assets += yearlyIncome - annualExp + investmentGain;

                    if (assets < 0) { isBankrupt = true; bankruptAge = age; break; }
                }
                setSimulationResult({ isBankrupt, bankruptAge });
            };

            React.useEffect(() => { if (profile) runSimulation(); }, [profile, lifestyle, activeRisks, savings]);

            const startAnalysis = () => {
                setProfile(createProfileFromInput()); // ë¶„ì„ ì‹œì‘ ì‹œ í”„ë¡œí•„ ìƒì„±
                setScreen('loading'); setLoadingStep(0);
                setTimeout(()=>setLoadingStep(1), 500); setTimeout(()=>setLoadingStep(2), 1000);
                setTimeout(()=>setLoadingStep(3), 1500); setTimeout(()=>{ setLoadingStep(4); }, 2000);
                setTimeout(()=>setScreen('result'), 2500);
            };

            const toggleRisk = (id) => setActiveRisks(p => ({...p, [id]: !p[id]}));
            const getStatus = (age) => {
                if(age>=100) return {color:'text-green-600', bg:'bg-green-50', bar:'bg-green-500', msg:'ì•ˆì „ ìƒíƒœ'};
                if(age>=80) return {color:'text-blue-600', bg:'bg-blue-50', bar:'bg-blue-500', msg:'ë³´í†µ ìƒíƒœ'};
                if(age>=70) return {color:'text-orange-600', bg:'bg-orange-50', bar:'bg-orange-500', msg:'ì£¼ì˜ í•„ìš”'};
                return {color:'text-red-600', bg:'bg-red-50', bar:'bg-red-500', msg:'ìœ„í—˜ ê²½ê³ '};
            };
            const resetAll = () => { 
                setScreen('intro'); setProfile(null); setSimulationResult(null); setAnalyzedData(null);
                setActiveRisks({}); setSavings(0); setLifestyle('standard'); setIsSubscribed(false); 
                setInputData({ age: 30, jobType: 'office', monthlyIncome: 300, totalAssets: '', monthlyExpense: '' });
            };
            const handleSubscribe = () => { setIsSubscribed(true); alert("âœ… êµ¬ë… ì™„ë£Œ! (ë°ëª¨ ê¸°ëŠ¥)"); };


            return (
                <div className="w-full max-w-[420px] bg-white shadow-2xl overflow-hidden flex flex-col h-full sm:h-[85vh] sm:max-h-[900px] sm:rounded-[32px] sm:border-[8px] sm:border-white relative transition-all">
                    
                    {/* --- [ë§ˆì´ë°ì´í„° ì—°ë™ í™”ë©´ (MVP)] --- */}
                    {screen === 'mydata' && (
                        <div className="flex-1 flex flex-col bg-white animate-fade-in relative">
                            {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
                            <div className="flex items-center p-4 border-b border-gray-100">
                                {myDataStep === 'select' && (
                                    <button onClick={() => setScreen('input')} className="p-2 -ml-2 text-gray-500"><Icon d={Icons.X} size={24} /></button>
                                )}
                                <h2 className="text-lg font-bold ml-2 flex-1 text-center pr-8">
                                    {myDataStep === 'select' ? 'ì—°ê²°í•  ê³„ì¢Œ ì„ íƒ' : (myDataStep === 'complete' ? 'ë¶„ì„ ì™„ë£Œ' : 'ê³„ì¢Œ ì—°ê²°')}
                                </h2>
                            </div>

                            {/* 1. ê³„ì¢Œ ì„ íƒ ë‹¨ê³„ */}
                            {myDataStep === 'select' && (
                                <div className="flex-1 overflow-y-auto p-6 pb-24">
                                    <p className="text-gray-500 mb-6">ìì‚° ìˆ˜ëª… ê³„ì‚°ì— ì‚¬ìš©í• <br/>ë‚´ ëª…ì˜ ê³„ì¢Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                                    <div className="space-y-4">
                                        {mockAccounts.map(acc => (
                                            <div key={acc.id} onClick={() => toggleAccountSelection(acc.id)} className="flex items-center justify-between p-4 bg-gray-50 rounded-2xl border border-gray-100 cursor-pointer hover:bg-gray-100 transition">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-xl shadow-sm">{acc.icon}</div>
                                                    <div>
                                                        <div className="font-bold text-gray-800">{acc.bank}</div>
                                                        <div className="text-sm text-gray-500">{acc.name}</div>
                                                    </div>
                                                </div>
                                                <div className={`custom-checkbox ${selectedAccounts.includes(acc.id) ? 'checked' : ''}`}>
                                                    {selectedAccounts.includes(acc.id) && <Icon d={Icons.Check} size={16} color="white" />}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* 2. ì—°ê²° ë° ë¶„ì„ ì¤‘ ë‹¨ê³„ (ë¡œë”© ì• ë‹ˆë©”ì´ì…˜) */}
                            {(myDataStep === 'connecting' || myDataStep === 'analyzing') && (
                                <div className="flex-1 flex flex-col justify-center items-center p-8">
                                    <div className="w-16 h-16 border-4 border-gray-100 border-t-[#3182F6] rounded-full animate-spin mb-8"></div>
                                    <h3 className="text-xl font-bold mb-2">{myDataStep === 'connecting' ? 'ì•ˆì „í•˜ê²Œ ì—°ê²° ì¤‘...' : 'ê±°ë˜ë‚´ì—­ ë¶„ì„ ì¤‘...'}</h3>
                                    <p className="text-gray-400 text-center">{myDataStep === 'connecting' ? 'ê¸ˆìœµê¸°ê´€ê³¼ ì•”í˜¸í™” í†µì‹ ì„ ì‹œì‘í•©ë‹ˆë‹¤.' : 'ìµœê·¼ 3ê°œì›” ì†Œë¹„ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬\nì£¼ìš” ìŠµê´€ì„ íŒŒì•…í•©ë‹ˆë‹¤.'}</p>
                                </div>
                            )}

                            {/* 3. ë¶„ì„ ì™„ë£Œ ë‹¨ê³„ (ê²°ê³¼ ìš”ì•½) */}
                            {myDataStep === 'complete' && analyzedData && (
                                <div className="flex-1 flex flex-col p-8 items-center justify-center animate-fade-in">
                                    <div className="text-6xl mb-6">ğŸ‰</div>
                                    <h2 className="text-2xl font-bold mb-2">ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                                    <p className="text-gray-500 mb-10 text-center">ë°œê²¬ëœ ìì‚°ê³¼ ì†Œë¹„ ë‚´ì—­ìœ¼ë¡œ<br/>ë” ì •í™•í•œ ì§„ë‹¨ì´ ê°€ëŠ¥í•´ì¡Œì–´ìš”.</p>
                                    
                                    <div className="w-full bg-gray-50 p-6 rounded-2xl border border-gray-100 mb-6 space-y-4">
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-500">ì´ ìˆœìì‚°</span>
                                            <span className="text-xl font-bold text-[#3182F6]">{formatMoney(analyzedData.totalAssets)}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-500">ì›” í‰ê·  ì§€ì¶œ</span>
                                            <span className="text-xl font-bold">{analyzedData.monthlyExpense.toLocaleString()}ë§Œì›</span>
                                        </div>
                                        <div className="pt-4 border-t border-gray-200">
                                            <span className="block text-sm text-gray-500 mb-2">ë‚˜ì˜ ì£¼ ì†Œë¹„ ìŠµê´€</span>
                                            <div className={`flex items-center gap-2 font-bold p-3 rounded-xl ${habitCategories[analyzedData.habit].bg} ${habitCategories[analyzedData.habit].color}`}>
                                                <Icon d={habitCategories[analyzedData.habit].icon} />
                                                <span>{habitCategories[analyzedData.habit].title}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ */}
                            <div className="p-6 border-t border-gray-100 bg-white absolute bottom-0 w-full">
                                {myDataStep === 'select' && (
                                    <button onClick={proceedToConnection} disabled={selectedAccounts.length === 0} className={`w-full py-4 rounded-xl font-bold transition ${selectedAccounts.length > 0 ? 'bg-[#3182F6] text-white active:scale-95' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>
                                        {selectedAccounts.length}ê°œ ê³„ì¢Œ ì—°ê²°í•˜ê¸°
                                    </button>
                                )}
                                {myDataStep === 'complete' && (
                                    <button onClick={applyMyDataResult} className="w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg">
                                        ì´ ë°ì´í„°ë¡œ ë¶„ì„ ì‹œì‘í•˜ê¸°
                                    </button>
                                )}
                            </div>
                        </div>
                    )}
                    {/* ------------------------------------ */}


                    {/* INTRO */}
                    {screen === 'intro' && (
                        <div className="flex-1 flex flex-col justify-center text-center p-8 animate-fade-in">
                            <div className="text-6xl mb-6 animate-bounce">ğŸª™</div>
                            <h1 className="text-2xl font-bold mb-4">ë‹¹ì‹ ì˜ ëˆì€<br/>ì–¸ì œ ì£½ì„ê¹Œìš”?</h1>
                            <p className="text-gray-400 mb-10 text-sm">í˜„ì¬ ì†Œë“ê³¼ ì§€ì¶œì„ ì…ë ¥í•˜ë©´<br/>ê¸ˆìœµ ìˆ˜ëª…ì„ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.<br/>(ë¬¼ê°€ìƒìŠ¹/ì„¸ê¸ˆ í˜„ì‹¤í™” ë²„ì „)</p>
                            <button onClick={()=>setScreen('input')} className="w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg">ë‚´ ë°ì´í„° ì…ë ¥í•˜ê¸°</button>
                        </div>
                    )}

                    {/* INPUT FORM */}
                    {screen === 'input' && (
                        <div className="flex-1 flex flex-col p-6 animate-fade-in bg-white overflow-y-auto">
                            <div className="flex items-center gap-2 mb-6">
                                <button onClick={()=>setScreen('intro')} className="text-gray-400 hover:text-gray-800"><Icon d="M19 12H5M12 19l-7-7 7-7" /></button>
                                <h2 className="text-xl font-bold">ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
                            </div>
                            
                            {/* ë§ˆì´ë°ì´í„° ì—°ë™ ë²„íŠ¼ (ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì™„ë£Œ í‘œì‹œ) */}
                            {!analyzedData ? (
                                <button onClick={startMyDataFlow} className="w-full py-3 mb-8 rounded-xl border border-gray-200 bg-gray-50 text-gray-600 font-bold text-sm flex items-center justify-center gap-2 hover:bg-gray-100 transition relative overflow-hidden group">
                                    <span className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"></span>
                                    <Icon d={Icons.Link} size={16} className="text-[#3182F6]" /> <span>ë‚´ ìì‚° ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° (MVP)</span>
                                </button>
                            ) : (
                                <div className="w-full py-3 mb-8 rounded-xl border border-[#3182F6]/30 bg-[#3182F6]/10 text-[#3182F6] font-bold text-sm flex items-center justify-center gap-2">
                                    <Icon d={Icons.Check} size={16} /> <span>ë‚´ ìì‚° ë°ì´í„° ì—°ë™ ì™„ë£Œ!</span>
                                </div>
                            )}

                            <div className="space-y-6">
                                <div className="input-group"><label>ë‚˜ì´ (ì„¸)</label><input type="number" name="age" value={inputData.age} onChange={handleInputChange} /></div>
                                <div className="input-group"><label>ì§ì—…êµ°</label><select name="jobType" value={inputData.jobType} onChange={handleInputChange}><option value="office">ì§ì¥ì¸</option><option value="civil">ê³µë¬´ì›/ê³µê¸°ì—…</option><option value="free">í”„ë¦¬ëœì„œ</option><option value="startup">ì‚¬ì—…ê°€/ìì˜ì—…</option><option value="pro">ì „ë¬¸ì§</option></select></div>
                                <div className="input-group"><label>ì›” í‰ê·  ì„¸í›„ ì†Œë“ (ë§Œì›)</label><input type="number" name="monthlyIncome" value={inputData.monthlyIncome} onChange={handleInputChange} /></div>
                                <div className="input-group"><label>í˜„ì¬ ìˆœìì‚° (ë¶€ì±„ ì œì™¸, ë§Œì›)</label><input type="number" name="totalAssets" value={inputData.totalAssets} onChange={handleInputChange} placeholder={analyzedData ? "" : "ì˜ˆ: 5000"} className={analyzedData ? "bg-blue-50/50 font-bold text-[#3182F6]" : ""} /></div>
                                <div className="input-group"><label>ì›” í‰ê·  ì§€ì¶œ (ìˆ¨ë§Œ ì‰¬ì–´ë„ ë‚˜ê°€ëŠ” ëˆ í¬í•¨)</label><input type="number" name="monthlyExpense" value={inputData.monthlyExpense} onChange={handleInputChange} className={analyzedData ? "bg-blue-50/50 font-bold text-[#3182F6]" : ""} /></div>
                            </div>
                            <button onClick={startAnalysis} className="mt-10 w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg flex items-center justify-center gap-2"><span>ë¶„ì„ ì‹œì‘í•˜ê¸°</span> <Icon d={Icons.ArrowRight} size={18} /></button>
                        </div>
                    )}

                    {/* LOADING */}
                    {screen === 'loading' && (
                        <div className="flex-1 flex flex-col justify-center items-center p-8 animate-fade-in">
                            <div className="w-12 h-12 border-4 border-gray-100 border-t-[#3182F6] rounded-full animate-spin mb-8"></div>
                            <div className="text-lg font-bold mb-2">ì •ë°€ ë¶„ì„ ì¤‘...</div>
                            {analyzedData && <div className="text-sm text-[#3182F6] font-bold mb-1">âœ¨ ì—°ë™ëœ ê¸ˆìœµ ë°ì´í„° ë°˜ì˜ë¨</div>}
                            <div className="text-sm text-gray-400 mb-10">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</div>
                            <div className="w-full space-y-4">
                                <div className={`flex items-center gap-3 ${loadingStep>=1?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Bank} /> <span>ë¬¼ê°€ìƒìŠ¹ë¥  ë°˜ì˜ ì¤‘</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=2?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Card} /> <span>ì„¸ê¸ˆ ë° ê³µì œ í•­ëª© ê³„ì‚°</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=3?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Activity} /> <span>ìƒì•  ì£¼ê¸° ë¦¬ìŠ¤í¬ ì ìš©</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=4?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Graph} /> <span>ìµœì¢… ê¸ˆìœµ ìˆ˜ëª… ì˜ˆì¸¡</span></div>
                            </div>
                        </div>
                    )}

                    {/* RESULT */}
                    {screen === 'result' && profile && simulationResult && (
                        <div className="flex-1 overflow-y-auto hide-scrollbar pb-10 animate-fade-in">
                            <div className="sticky top-0 bg-white/95 backdrop-blur z-10 p-6 border-b border-gray-100">
                                <div className="flex justify-center mb-4 relative">
                                    <span className="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full font-bold flex items-center gap-1"><Icon d={Icons.User} size={14}/> {profile.age}ì„¸ Â· {profile.job}</span>
                                    {/* ë§ˆì´ë°ì´í„° ë°°ì§€ í‘œì‹œ */}
                                    {profile.habit && (
                                        <div className={`absolute right-0 top-[-10px] flex items-center gap-1 px-2 py-1 rounded-full text-[10px] font-bold border ${habitCategories[profile.habit].bg} ${habitCategories[profile.habit].color} border-current`}>
                                            <Icon d={habitCategories[profile.habit].icon} size={12} /> {habitCategories[profile.habit].title}
                                        </div>
                                    )}
                                </div>
                                <div className="text-center mb-6">
                                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold mb-2 ${getStatus(simulationResult.bankruptAge).bg} ${getStatus(simulationResult.bankruptAge).color}`}>{getStatus(simulationResult.bankruptAge).msg}</span>
                                    <div className="text-3xl font-extrabold leading-tight">ë‹¹ì‹ ì˜ ëˆì€<br/><span className={getStatus(simulationResult.bankruptAge).color}>{simulationResult.isBankrupt ? `${simulationResult.bankruptAge}ì„¸` : '100ì„¸+'}</span>ì— ì‚¬ë§í•©ë‹ˆë‹¤.</div>
                                </div>
                                <div className="flex justify-center gap-2 mb-6">
                                    {['basic','standard','rich'].map(l => (
                                        <button key={l} onClick={()=>setLifestyle(l)} className={`px-4 py-2 rounded-full text-xs font-bold border transition ${lifestyle===l?'bg-[#191F28] text-white border-[#191F28]':'bg-white text-gray-500 hover:bg-gray-50'}`}>{l==='basic'?'ì ˆì•½':l==='standard'?'ë³´í†µ':'ì—¬ìœ '}</button>
                                    ))}
                                </div>
                                <div className="mb-2">
                                    <div className="flex justify-between text-xs font-bold text-gray-500 mb-2"><span>ğŸ’¸ ìì‚° ìˆ˜ëª…</span><span>{simulationResult.bankruptAge}ì„¸</span></div>
                                    <div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                                        <div className={`h-full transition-all duration-700 ${getStatus(simulationResult.bankruptAge).bar}`} style={{width:`${Math.min(100, simulationResult.bankruptAge)}%`}}></div>
                                    </div>
                                    <p className="text-center text-[10px] text-gray-400 mt-2">â–² ì¸í”Œë ˆì´ì…˜ 3%, ì„¸ê¸ˆ 15.4% ë°˜ì˜</p>
                                </div>
                            </div>

                            <div className="p-6">
                                <div className="flex items-center gap-2 text-lg font-bold mb-4"><Icon d={Icons.Alert} color="#FF8D4D" /> <span>{Math.floor(profile.age/10)*10}ëŒ€ ë¼ì´í”„ ë¦¬ìŠ¤í¬</span></div>
                                {profile.risks.map(r => (
                                    <div key={r.id} onClick={() => toggleRisk(r.id)} className="bg-white border border-gray-100 p-4 rounded-2xl mb-3 shadow-sm cursor-pointer hover:bg-gray-50 transition-colors relative">
                                        <div className="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded inline-block mb-2">âš ï¸ ìœ„í—˜ë„ {r.prob}</div>
                                        <div className="flex justify-between items-center mb-1">
                                            <span className="font-bold text-gray-800">{r.title}</span>
                                            <div className={`w-11 h-6 rounded-full relative transition-colors ${activeRisks[r.id] ? 'bg-[#FF8D4D]' : 'bg-gray-200'}`}>
                                                <div className={`absolute top-[2px] left-[2px] bg-white border border-gray-300 rounded-full h-5 w-5 transition-transform ${activeRisks[r.id] ? 'translate-x-full border-white' : ''}`}></div>
                                            </div>
                                        </div>
                                        <div className="flex justify-between text-xs text-gray-500"><span>ì˜ˆìƒ ì†ì‹¤ì•¡</span><span className="text-[#E94658] font-bold">-{formatMoney(r.loss)}</span></div>
                                    </div>
                                ))}
                            </div>

                            <div className="p-6 bg-gray-50 border-t border-gray-100">
                                <div className="flex items-center gap-2 text-lg font-bold mb-4 text-gray-800"><Icon d={Icons.Shield} color="#3182F6" /> <span>ì†”ë£¨ì…˜ ì‹œë®¬ë ˆì´í„°</span></div>
                                <div className="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm mb-6">
                                    <div className="text-sm font-bold text-[#3182F6] mb-4">â˜•ï¸ ì›” ì €ì¶•ì„ ëŠ˜ë¦°ë‹¤ë©´?</div>
                                    <input type="range" min="0" max="200" step="10" value={savings} onChange={(e)=>setSavings(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" style={{background: `linear-gradient(to right, #3182F6 ${(savings/200)*100}%, #e5e7eb ${(savings/200)*100}%)`}}/>
                                    <div className="flex justify-between items-center mt-4"><span className="text-xs text-gray-500">ì¶”ê°€ ì €ì¶•ì•¡</span><span className="text-lg font-bold text-[#3182F6]">{savings}ë§Œì›</span></div>
                                </div>
                                
                                {/* êµ¬ë… ë²„íŠ¼ ì„¹ì…˜ */}
                                <div className="bg-[#E8F3FF] p-5 rounded-2xl mb-6">
                                    <div className="flex items-start gap-3">
                                        <div className="bg-white p-2 rounded-full text-[#3182F6]"><Icon d={Icons.Bell} /></div>
                                        <div>
                                            <h3 className="font-bold text-[#3182F6] text-sm mb-1">ë§¤ì£¼ ë¦¬í¬íŠ¸ ë°›ê¸°</h3>
                                            <p className="text-xs text-gray-600 mb-3">ë³€ë™ë˜ëŠ” ìì‚° ìˆ˜ëª…ì„<br/>ë§¤ì£¼ ì•Œë¦¼ìœ¼ë¡œ ì²´í¬í•˜ì„¸ìš”.</p>
                                            <button onClick={handleSubscribe} disabled={isSubscribed} className={`w-full py-3 rounded-xl text-sm font-bold transition ${isSubscribed ? 'bg-gray-400 text-white cursor-default' : 'bg-[#3182F6] text-white active:scale-95 shadow-md'}`}>{isSubscribed ? 'êµ¬ë… ì¤‘' : 'êµ¬ë…í•˜ê¸°'}</button>
                                        </div>
                                    </div>
                                </div>

                                <button onClick={resetAll} className="w-full py-4 bg-white text-gray-600 border border-gray-200 rounded-xl font-bold flex justify-center items-center gap-2 shadow-sm active:scale-95 transition hover:bg-gray-50"><Icon d={Icons.Refresh} /> <span>ë‹¤ì‹œ ì…ë ¥í•˜ê¸°</span></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LifePortSimulator />);
    </script>
</body>
</html>
