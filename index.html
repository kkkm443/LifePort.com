<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3182F6">
    <title>LifePort - Realistic Logic</title>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icon.png">
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        /* í™”ë©´ ê½‰ ì°¨ê²Œ ì„¤ì • ë° ì¤‘ì•™ ì •ë ¬ */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        body { font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        #root { height: 100%; display: flex; justify-content: center; align-items: center; }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #ffffff; border: 2px solid #3182F6;
            box-shadow: 0 2px 6px rgba(49, 130, 246, 0.4); margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; border-radius: 4px;
        }
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-group label { display: block; font-size: 13px; color: #6b7280; margin-bottom: 6px; font-weight: 600; }
        .input-group input, .input-group select { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e5e7eb; 
            font-size: 16px; font-weight: 500; color: #1f2937; outline: none; transition: all 0.2s;
            background-color: #fff;
        }
        .input-group input:focus, .input-group select:focus { border-color: #3182F6; ring: 2px solid #3182F6; }
    </style>
</head>
<body class="bg-[#F2F4F6]">
    <div id="root"></div>

    <script type="text/babel">
        const Icon = ({ d, size=20, color="currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d={d} /></svg>
        );
        const Icons = {
            User: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8",
            Alert: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01",
            Shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
            Refresh: "M23 4v6h-6 M1 20v-6h6 M3.51 9a9 9 0 0 1 14.85-3.36L23 10 M1 14l4.64 4.36A9 9 0 0 0 20.49 15",
            Bank: "M3 22h18 M6 18v-7 M10 18v-7 M14 18v-7 M18 18v-7 M12 2l8 5H4z",
            Card: "M1 4h22v16H1z M1 10h22",
            Graph: "M23 6l-9.5 9.5-5-5L1 18",
            Activity: "M22 12h-4l-3 9L9 3l-3 9H2",
            ArrowRight: "M5 12h14 M12 5l7 7-7 7",
            Bell: "M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9 M13.73 21a2 2 0 0 1-3.46 0",
            Link: "M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
        };

        const LifePortSimulator = () => {
            const [screen, setScreen] = React.useState('intro'); 
            const [loadingStep, setLoadingStep] = React.useState(0);
            
            const [inputData, setInputData] = React.useState({
                age: 30, jobType: 'office', monthlyIncome: 300, totalAssets: 5000, monthlyExpense: 150
            });

            const [profile, setProfile] = React.useState(null);
            const [simulationResult, setSimulationResult] = React.useState(null);
            const [lifestyle, setLifestyle] = React.useState('standard'); 
            const [activeRisks, setActiveRisks] = React.useState({}); 
            const [savings, setSavings] = React.useState(0); 
            const [isSubscribed, setIsSubscribed] = React.useState(false);

            // ì§ì—…ë³„ ê¸°ë³¸ ì„¸íŒ…
            const jobTraits = {
                office: { title: 'ì§ì¥ì¸', retirementAge: 60, investMin: 2, investMax: 4 },
                free: { title: 'í”„ë¦¬ëœì„œ', retirementAge: 65, investMin: 2, investMax: 5 },
                civil: { title: 'ê³µë¬´ì›', retirementAge: 60, investMin: 1.5, investMax: 3 },
                startup: { title: 'ì°½ì—…/ì‚¬ì—…ê°€', retirementAge: 65, investMin: 1, investMax: 6 },
                pro: { title: 'ì „ë¬¸ì§', retirementAge: 68, investMin: 2.5, investMax: 5.5 }
            };

            // [ìˆ˜ì •] 20ëŒ€(ê¸°ê°„ì œ ë³€ê²½) ë° 50ëŒ€ ë¦¬ìŠ¤í¬ ì •ì˜ ìˆ˜ì •
            const riskScenarios = {
                // 20ëŒ€: ê²°í˜¼/ì°¨ëŸ‰ì„ ì¼ì‹œë¶ˆì´ ì•„ë‹Œ 'í• ë¶€/ì¤€ë¹„ê¸°ê°„' ê°œë…(period)ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì¦‰ì‹œ íŒŒì‚° ë°©ì§€
                20: [
                    { id: 'marriage', title: 'ğŸ’ ê²°í˜¼/ë…ë¦½ ì¤€ë¹„', loss: 8000, prob: '70%', period: 5 }, // 5ë…„ ìƒí™˜/ì €ì¶•
                    { id: 'car', title: 'ğŸš— ì°¨ëŸ‰ í• ë¶€ êµ¬ë§¤', loss: 3000, prob: '60%', period: 3 }     // 3ë…„ í• ë¶€
                ],
                30: [{ id: 'housing', title: 'ğŸ  ì£¼íƒ ëŒ€ì¶œ ì´ì', loss: 10000, prob: '50%', period: 30 }, { id: 'child', title: 'ğŸ‘¶ ìœ¡ì•„ ë¹„ìš©', loss: 4000, prob: '40%', period: 5 }],
                40: [{ id: 'education', title: 'ğŸ“ ìë…€ êµìœ¡ë¹„', loss: 12000, prob: '80%', period: 12 }, { id: 'medical', title: 'ğŸ¥ ê°€ì¡± ì˜ë£Œë¹„', loss: 5000, prob: '24%' }],
                // 50ëŒ€: ì¡°ê¸° í‡´ì§ì€ ë¹„ìš©(loss)ë„ ìˆì§€ë§Œ ë¡œì§ì—ì„œ 'ì†Œë“ ì¤‘ë‹¨'ì„ íŠ¸ë¦¬ê±°í•¨
                50: [{ id: 'business', title: 'ğŸ“‰ íˆ¬ì/ì‚¬ì—… ì†ì‹¤', loss: 15000, prob: '30%' }, { id: 'job', title: 'ğŸ’¼ ì¡°ê¸° í‡´ì§', loss: 5000, prob: '15%' }],
                60: [{ id: 'health', title: 'ğŸ¥ ë…¸í›„ ì˜ë£Œë¹„', loss: 8000, prob: '35%', period: 20 }, { id: 'scam', title: 'ğŸ’¸ ì‚¬ê¸°/ë¶„ìŸ', loss: 10000, prob: '15%' }]
            };

            const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const formatMoney = (val) => val >= 10000 ? (val/10000).toFixed(1).replace('.0','') + 'ì–µ' : val.toLocaleString() + 'ë§Œì›';

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                if (name === 'jobType') {
                    setInputData(prev => ({ ...prev, [name]: value }));
                } else {
                    setInputData(prev => ({ ...prev, [name]: value === '' ? '' : Number(value) }));
                }
            };

            // ë§ˆì´ë°ì´í„° ì—°ë™ (ê°€ìƒ ê¸°ëŠ¥)
            const handleMyDataConnect = () => {
                alert("ğŸ”’ ë§ˆì´ë°ì´í„° ë³´ì•ˆ ëª¨ë“ˆ ë¡œë”© ì¤‘...\n\n(í˜„ì¬ëŠ” ë°ëª¨ ë²„ì „ì…ë‹ˆë‹¤. ì¶”í›„ ì‹¤ì œ ì€í–‰/ì¹´ë“œì‚¬ APIì™€ ì—°ë™ë˜ì–´ ìì‚°ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.)");
            };

            const createProfileFromInput = () => {
                const trait = jobTraits[inputData.jobType];
                const safeInput = {
                    age: Number(inputData.age) || 30,
                    monthlyIncome: Number(inputData.monthlyIncome) || 0,
                    monthlyExpense: Number(inputData.monthlyExpense) || 0,
                    totalAssets: Number(inputData.totalAssets) || 0
                };
                const ageKey = Math.floor(safeInput.age/10)*10;
                const safeAgeKey = (ageKey > 60) ? 60 : (ageKey < 20 ? 20 : ageKey);

                return {
                    age: safeInput.age, job: trait.title, monthlyIncome: safeInput.monthlyIncome, baseMonthlyExpense: safeInput.monthlyExpense,
                    totalAssets: safeInput.totalAssets, totalDebt: 0, 
                    risks: riskScenarios[safeAgeKey] || riskScenarios[40],
                    retirementAge: trait.retirementAge, investmentReturn: rand(trait.investMin * 10, trait.investMax * 10) / 10 
                };
            };

            // [ìˆ˜ì •ëœ ë¶€ë¶„] ê·¹ì‚¬ì‹¤ì£¼ì˜ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ì ìš©
            const runSimulation = () => {
                if (!profile) return;
                
                // --- [ì‚¬ì‹¤ì£¼ì˜ ìƒìˆ˜ ì •ì˜] ---
                const INFLATION_RATE = 0.03;       // ë¬¼ê°€ìƒìŠ¹ë¥  3%
                const INCOME_GROWTH_RATE = 0.03;   // ì„ê¸ˆìƒìŠ¹ë¥  3%
                const TAX_RATE = 0.154;            // ì´ì/ë°°ë‹¹ì†Œë“ì„¸ 15.4%
                // -------------------------

                let assets = profile.totalAssets;
                let isBankrupt = false;
                let bankruptAge = 100;
                
                // [ë°¸ëŸ°ìŠ¤ ìˆ˜ì •] ì—¬ìœ  ëª¨ë“œ ê°€ì¤‘ì¹˜ ì™„í™” (1.4 -> 1.2) / ì ˆì•½ (0.8 -> 0.85)
                // ê¸°ì¡´ 1.4ë°°ëŠ” ë¬¼ê°€ìƒìŠ¹ ë³µë¦¬ì™€ ë§Œë‚˜ë©´ íŒŒì‚° ì†ë„ê°€ ë„ˆë¬´ ë¹¨ëìŒ
                let lifestyleMult = lifestyle === 'basic' ? 0.85 : (lifestyle === 'rich' ? 1.2 : 1.0);
                
                // [ìˆ˜ì •] ì¡°ê¸° í‡´ì§(50ëŒ€) ë¦¬ìŠ¤í¬ í™•ì¸: í™œì„±í™” ì‹œ ì‹¤ì œ ì€í‡´ ë‚˜ì´ë¥¼ í˜„ì¬ ë‚˜ì´ë¡œ ì•ë‹¹ê¹€
                const isEarlyRetired = activeRisks['job'];
                const effectiveRetirementAge = isEarlyRetired ? profile.age : profile.retirementAge;

                // [ë¡œì§ ìˆ˜ì •] ì´ˆê¸° ë¦¬ìŠ¤í¬ ì°¨ê° (ê¸°ê°„ì´ ì—†ëŠ” ì¼ì‹œë¶ˆ í•­ëª©ë§Œ ì¦‰ì‹œ ì°¨ê°)
                Object.keys(activeRisks).forEach(id => { 
                    if(activeRisks[id]) {
                        const risk = profile.risks.find(r=>r.id===id);
                        if (!risk.period) { // periodê°€ ì—†ìœ¼ë©´ ì¼ì‹œë¶ˆ ì†ì‹¤ (ì˜ˆ: ì‚¬ì—… ì‹¤íŒ¨, ì‚¬ê¸°)
                            assets -= risk.loss; 
                        }
                    }
                });

                // ì—°ë ¹ë³„ ì‹œë®¬ë ˆì´ì…˜
                for (let age = profile.age; age <= 100; age++) {
                    const yearIndex = age - profile.age;
                    
                    // 1. ì†Œë“ ê³„ì‚° (ì¡°ê¸° í‡´ì§ ë°˜ì˜)
                    let yearlyIncome = 0;
                    if (age <= effectiveRetirementAge) {
                        // ì€í‡´ ì „: ì„ê¸ˆ ìƒìŠ¹ë¥  ì ìš©ëœ ì—°ë´‰
                        yearlyIncome = (profile.monthlyIncome * 12) * Math.pow(1 + INCOME_GROWTH_RATE, yearIndex);
                    } else {
                        // ì€í‡´ í›„: êµ­ë¯¼ì—°ê¸ˆ/ì€í‡´ ìƒí™œë¹„ (í˜„ ì†Œë“ì˜ 40% ê°€ì •í•˜ë˜ ë¬¼ê°€ ì—°ë™ ìƒìŠ¹)
                        // ì¡°ê¸° í‡´ì§ ì‹œ ì†Œë“ ì ˆë²½ ë°œìƒ (ì¦‰ì‹œ ì—°ê¸ˆ/ì €ì¶• ì˜ì¡´ ëª¨ë“œë¡œ ì „í™˜)
                        const basePension = Math.min(profile.monthlyIncome * 0.4, 200);
                        yearlyIncome = (basePension * 12) * Math.pow(1 + INFLATION_RATE, yearIndex);
                    }

                    // 2. ì§€ì¶œ ê³„ì‚° (ë¬¼ê°€ìƒìŠ¹ë¥  ë³µë¦¬ ì ìš©)
                    let currentBaseExpense = (profile.baseMonthlyExpense * lifestyleMult);
                    let currentAdditionalSavings = savings * Math.pow(1 + INFLATION_RATE, yearIndex); 
                    
                    // ìˆœìˆ˜ ì§€ì¶œì•¡ = (ê¸°ë³¸ìƒí™œë¹„ - ì¶”ê°€ì €ì¶•ì•¡)
                    let realMonthlyExpense = currentBaseExpense - currentAdditionalSavings;
                    
                    // [ìˆ˜ì • í•µì‹¬] ìµœì†Œ ìƒê³„ë¹„ì—ë„ ë¼ì´í”„ìŠ¤íƒ€ì¼ ê³„ìˆ˜ ë°˜ì˜
                    // ì—¬ìœ (1.2ë°°) / ë³´í†µ(1.0ë°°) / ì ˆì•½(0.85ë°°)ì— ë”°ë¼ ìˆ¨ë§Œ ì‰¬ì–´ë„ ë‚˜ê°€ëŠ” í•˜í•œì„  ì°¨ë“± ì ìš©
                    let minLivingBase = (60 * lifestyleMult) + (age - 30) * 0.5; 
                    let minLivingInflated = minLivingBase * Math.pow(1 + INFLATION_RATE, yearIndex);
                    
                    // ì§€ì¶œì´ ìµœì†Œ ìƒê³„ë¹„ ë°‘ìœ¼ë¡œ ë‚´ë ¤ê°€ì§€ ì•Šë„ë¡ ë³´ì •
                    if (realMonthlyExpense < minLivingInflated) realMonthlyExpense = minLivingInflated;

                    let annualExp = realMonthlyExpense * 12 * Math.pow(1 + INFLATION_RATE, yearIndex);
                    
                    // [ì¶”ê°€] ê¸°ê°„ì œ ë¦¬ìŠ¤í¬ ë¹„ìš© ì¶”ê°€ (ê²°í˜¼, ì°¨ëŸ‰, ëŒ€ì¶œ ë“±)
                    Object.keys(activeRisks).forEach(id => {
                        if(activeRisks[id]) {
                            const risk = profile.risks.find(r=>r.id===id);
                            // ë¦¬ìŠ¤í¬ì— ê¸°ê°„(period)ì´ ìˆê³ , ì•„ì§ ë‚©ë¶€ ê¸°ê°„ ë‚´ë¼ë©´
                            if (risk.period && age < profile.age + risk.period) {
                                // ì—°ê°„ ë¹„ìš© = ì´ë¹„ìš© / ê¸°ê°„ (ë¬¼ê°€ìƒìŠ¹ ë°˜ì˜)
                                const annualRiskCost = (risk.loss / risk.period) * Math.pow(1 + INFLATION_RATE, yearIndex);
                                annualExp += annualRiskCost;
                            }
                        }
                    });

                    // 3. íˆ¬ì ìˆ˜ìµ ê³„ì‚° (ì„¸ê¸ˆ 15.4% ì°¨ê°)
                    // ì€í‡´ í›„ì—ëŠ” ì•ˆì •ì  ìš´ìš©ìœ¼ë¡œ ìˆ˜ìµë¥  í•˜ë½ ê°€ì •
                    let rawReturnRate = (age <= effectiveRetirementAge) ? profile.investmentReturn : (profile.investmentReturn * 0.7);
                    let netReturnRate = (rawReturnRate / 100) * (1 - TAX_RATE); // ì„¸í›„ ìˆ˜ìµë¥ 
                    
                    let investmentGain = (assets > 0) ? assets * netReturnRate : 0;
                    
                    // 4. ìì‚° ë³€ë™
                    let netFlow = yearlyIncome - annualExp + investmentGain;
                    assets += netFlow;

                    if (assets < 0) {
                        // ìì‚°ì´ ë§ˆì´ë„ˆìŠ¤ê°€ ë˜ë©´ íŒŒì‚°ìœ¼ë¡œ ê°„ì£¼ (ë‹¨, ë¹šìœ¼ë¡œ ë²„í‹°ëŠ” êµ¬ê°„ ì—†ì´ ë°”ë¡œ íŒŒì‚° ì²˜ë¦¬)
                         isBankrupt = true; 
                         bankruptAge = age; 
                         break;
                    }
                }

                const currentExp = (profile.baseMonthlyExpense * lifestyleMult) - savings;
                const safeExp = currentExp > 0 ? currentExp : 1;
                const savingRate = Math.round(((profile.monthlyIncome - currentExp) / profile.monthlyIncome) * 100);
                const liquid = Math.max(0, assets * 0.2); // ìµœì¢… ìì‚°ì´ ì•„ë‹Œ í˜„ì¬ ìœ ë™ì„± ì¶”ì •ì¹˜ë¡œ ë³€ê²½ í•„ìš”í•˜ë‚˜, UI í˜¸í™˜ ìœ„í•´ ìœ ì§€
                
                setSimulationResult({ isBankrupt, bankruptAge, savingRate: Math.max(0, savingRate), dsr: 0, emergency: (profile.totalAssets * 0.2 / safeExp).toFixed(1) });
            };

            React.useEffect(() => { if (profile) runSimulation(); }, [profile, lifestyle, activeRisks, savings]);

            const goInput = () => setScreen('input');
            const startAnalysis = () => {
                setScreen('loading'); setLoadingStep(0);
                setTimeout(()=>setLoadingStep(1), 500); setTimeout(()=>setLoadingStep(2), 1000);
                setTimeout(()=>setLoadingStep(3), 1500); setTimeout(()=>{ setLoadingStep(4); setProfile(createProfileFromInput()); }, 2000);
                setTimeout(()=>setScreen('result'), 2500);
            };

            const toggleRisk = (id) => setActiveRisks(p => ({...p, [id]: !p[id]}));
            const getStatus = (age) => {
                if(age>=100) return {color:'text-green-600', bg:'bg-green-50', bar:'bg-green-500', msg:'ì•ˆì „ ìƒíƒœ'};
                if(age>=80) return {color:'text-blue-600', bg:'bg-blue-50', bar:'bg-blue-500', msg:'ë³´í†µ ìƒíƒœ'};
                if(age>=70) return {color:'text-orange-600', bg:'bg-orange-50', bar:'bg-orange-500', msg:'ì£¼ì˜ í•„ìš”'};
                return {color:'text-red-600', bg:'bg-red-50', bar:'bg-red-500', msg:'ìœ„í—˜ ê²½ê³ '};
            };
            const resetAll = () => { 
                setScreen('intro'); setProfile(null); setSimulationResult(null); 
                setActiveRisks({}); setSavings(0); setLifestyle('standard'); 
                setIsSubscribed(false); 
            };

            // [FIXED] êµ¬ë… ë²„íŠ¼ í•¸ë“¤ëŸ¬ (ê°•ë ¥í•œ ìƒíƒœ ë³€ê²½ ë³´ì¥)
            const handleSubscribe = async () => {
                // 1. ë¸Œë¼ìš°ì € ë¯¸ì§€ì› ì‹œ (ì‹œë®¬ë ˆì´ì…˜ ì²˜ë¦¬)
                if (!('Notification' in window)) {
                    setIsSubscribed(true);
                    alert("êµ¬ë… ì™„ë£Œ! (ì•Œë¦¼ ë¯¸ì§€ì› í™˜ê²½ì…ë‹ˆë‹¤)");
                    return;
                }

                // 2. ì´ë¯¸ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°
                if (Notification.permission === 'granted') {
                    setIsSubscribed(true);
                    alert("âœ… ì´ë¯¸ êµ¬ë… ì¤‘ì…ë‹ˆë‹¤. ë§¤ì£¼ ì›”ìš”ì¼ ë¦¬í¬íŠ¸ê°€ ë°œì†¡ë©ë‹ˆë‹¤.");
                    return;
                }

                // 3. ê¶Œí•œì´ ê±°ë¶€ëœ ê²½ìš° (ì•ˆë‚´ë§Œ)
                if (Notification.permission === 'denied') {
                    alert("ğŸš« ì•Œë¦¼ ê¶Œí•œì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.");
                    return;
                }

                // 4. ê¶Œí•œ ìš”ì²­
                try {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        setIsSubscribed(true);
                        alert("âœ… êµ¬ë… ì™„ë£Œ! ë§¤ì£¼ ì›”ìš”ì¼ ë¦¬í¬íŠ¸ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.");
                    } else {
                        alert("ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì•¼ ë¦¬í¬íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                    }
                } catch (e) {
                    console.error(e);
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            };

            return (
                // [ìˆ˜ì •] ëª¨ë°”ì¼ í• ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì ìš© (PCì—ì„œ ì¤‘ì•™ ì •ë ¬ ë° ë‘¥ê·¼ ëª¨ì„œë¦¬)
                <div className="w-full max-w-[420px] bg-white shadow-2xl overflow-hidden flex flex-col h-full sm:h-[85vh] sm:max-h-[900px] sm:rounded-[32px] sm:border-[8px] sm:border-white relative transition-all">
                    {/* INTRO */}
                    {screen === 'intro' && (
                        <div className="flex-1 flex flex-col justify-center text-center p-8 animate-fade-in">
                            <div className="text-6xl mb-6 animate-bounce">ğŸª™</div>
                            <h1 className="text-2xl font-bold mb-4">ë‹¹ì‹ ì˜ ëˆì€<br/>ì–¸ì œ ì£½ì„ê¹Œìš”?</h1>
                            <p className="text-gray-400 mb-10 text-sm">í˜„ì¬ ì†Œë“ê³¼ ì§€ì¶œì„ ì…ë ¥í•˜ë©´<br/>ê¸ˆìœµ ìˆ˜ëª…ì„ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.<br/>(ë¬¼ê°€ìƒìŠ¹/ì„¸ê¸ˆ í˜„ì‹¤í™” ë²„ì „)</p>
                            <button onClick={goInput} className="w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg">ë‚´ ë°ì´í„° ì…ë ¥í•˜ê¸°</button>
                        </div>
                    )}

                    {/* INPUT FORM */}
                    {screen === 'input' && (
                        <div className="flex-1 flex flex-col p-6 animate-fade-in bg-white overflow-y-auto">
                            <div className="flex items-center gap-2 mb-6">
                                <button onClick={()=>setScreen('intro')} className="text-gray-400 hover:text-gray-800"><Icon d="M19 12H5M12 19l-7-7 7-7" /></button>
                                <h2 className="text-xl font-bold">ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
                            </div>
                            <button onClick={handleMyDataConnect} className="w-full py-3 mb-8 rounded-xl border border-gray-200 bg-gray-50 text-gray-600 font-bold text-sm flex items-center justify-center gap-2 hover:bg-gray-100 transition">
                                <Icon d={Icons.Link} size={16} /> <span>ë‚´ ìì‚° ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°</span>
                            </button>
                            <div className="space-y-6">
                                <div className="input-group"><label>ë‚˜ì´ (ì„¸)</label><input type="number" name="age" value={inputData.age} onChange={handleInputChange} /></div>
                                <div className="input-group"><label>ì§ì—…êµ°</label><select name="jobType" value={inputData.jobType} onChange={handleInputChange}><option value="office">ì§ì¥ì¸</option><option value="civil">ê³µë¬´ì›/ê³µê¸°ì—…</option><option value="free">í”„ë¦¬ëœì„œ</option><option value="startup">ì‚¬ì—…ê°€/ìì˜ì—…</option><option value="pro">ì „ë¬¸ì§</option></select></div>
                                <div className="input-group"><label>ì›” í‰ê·  ì„¸í›„ ì†Œë“ (ë§Œì›)</label><input type="number" name="monthlyIncome" value={inputData.monthlyIncome} onChange={handleInputChange} /></div>
                                <div className="input-group"><label>í˜„ì¬ ìˆœìì‚° (ë¶€ì±„ ì œì™¸, ë§Œì›)</label><input type="number" name="totalAssets" value={inputData.totalAssets} onChange={handleInputChange} placeholder="ì˜ˆ: 5000" /></div>
                                <div className="input-group"><label>ì›” í‰ê·  ì§€ì¶œ (ìˆ¨ë§Œ ì‰¬ì–´ë„ ë‚˜ê°€ëŠ” ëˆ í¬í•¨)</label><input type="number" name="monthlyExpense" value={inputData.monthlyExpense} onChange={handleInputChange} /></div>
                            </div>
                            <button onClick={startAnalysis} className="mt-10 w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg flex items-center justify-center gap-2"><span>ë¶„ì„ ì‹œì‘í•˜ê¸°</span> <Icon d={Icons.ArrowRight} size={18} /></button>
                        </div>
                    )}

                    {/* LOADING */}
                    {screen === 'loading' && (
                        <div className="flex-1 flex flex-col justify-center items-center p-8 animate-fade-in">
                            <div className="w-12 h-12 border-4 border-gray-100 border-t-[#3182F6] rounded-full animate-spin mb-8"></div>
                            <div className="text-lg font-bold mb-2">ë°ì´í„° ë¶„ì„ ì¤‘...</div>
                            <div className="text-sm text-gray-400 mb-10">ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤</div>
                            <div className="w-full space-y-4">
                                <div className={`flex items-center gap-3 ${loadingStep>=1?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Bank} /> <span>ë¬¼ê°€ìƒìŠ¹ë¥  ë°˜ì˜ ì¤‘</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=2?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Card} /> <span>ì´ìì†Œë“ì„¸ ì°¨ê° ì¤‘</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=3?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Activity} /> <span>ìƒì•  ì£¼ê¸° ë¦¬ìŠ¤í¬ ì ìš©</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=4?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Graph} /> <span>ì‹¤ì§ˆ êµ¬ë§¤ë ¥ ì‹œë®¬ë ˆì´ì…˜</span></div>
                            </div>
                        </div>
                    )}

                    {/* RESULT */}
                    {screen === 'result' && profile && simulationResult && (
                        <div className="flex-1 overflow-y-auto hide-scrollbar pb-10 animate-fade-in">
                            <div className="sticky top-0 bg-white/95 backdrop-blur z-10 p-6 border-b border-gray-100">
                                <div className="flex justify-center mb-4">
                                    <span className="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full font-bold flex items-center gap-1"><Icon d={Icons.User} size={14}/> {profile.age}ì„¸ Â· {profile.job}</span>
                                </div>
                                <div className="text-center mb-6">
                                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold mb-2 ${getStatus(simulationResult.bankruptAge).bg} ${getStatus(simulationResult.bankruptAge).color}`}>{getStatus(simulationResult.bankruptAge).msg}</span>
                                    <div className="text-3xl font-extrabold leading-tight">ë‹¹ì‹ ì˜ ëˆì€<br/><span className={getStatus(simulationResult.bankruptAge).color}>{simulationResult.isBankrupt ? `${simulationResult.bankruptAge}ì„¸` : '100ì„¸+'}</span>ì— ì‚¬ë§í•©ë‹ˆë‹¤.</div>
                                </div>
                                <div className="flex justify-center gap-2 mb-6">
                                    {['basic','standard','rich'].map(l => (
                                        <button key={l} onClick={()=>setLifestyle(l)} className={`px-4 py-2 rounded-full text-xs font-bold border transition ${lifestyle===l?'bg-[#191F28] text-white border-[#191F28]':'bg-white text-gray-500 hover:bg-gray-50'}`}>{l==='basic'?'ì ˆì•½':l==='standard'?'ë³´í†µ':'ì—¬ìœ '}</button>
                                    ))}
                                </div>
                                <div className="mb-2">
                                    <div className="flex justify-between text-xs font-bold text-gray-500 mb-2"><span>ğŸ’¸ ìì‚° ìˆ˜ëª…</span><span>{simulationResult.bankruptAge}ì„¸</span></div>
                                    <div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                                        <div className={`h-full transition-all duration-700 ${getStatus(simulationResult.bankruptAge).bar}`} style={{width:`${Math.min(100, simulationResult.bankruptAge)}%`}}></div>
                                    </div>
                                    <p className="text-center text-[10px] text-gray-400 mt-2">â–² ì¸í”Œë ˆì´ì…˜ 3%, ì„¸ê¸ˆ 15.4% ë°˜ì˜</p>
                                </div>
                            </div>

                            <div className="p-6">
                                <div className="flex items-center gap-2 text-lg font-bold mb-4"><Icon d={Icons.Alert} color="#FF8D4D" /> <span>{Math.floor(profile.age/10)*10}ëŒ€ ë¼ì´í”„ ë¦¬ìŠ¤í¬</span></div>
                                {profile.risks.map(r => (
                                    <div key={r.id} onClick={() => toggleRisk(r.id)} className="bg-white border border-gray-100 p-4 rounded-2xl mb-3 shadow-sm cursor-pointer hover:bg-gray-50 transition-colors relative">
                                        <div className="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded inline-block mb-2">âš ï¸ ìœ„í—˜ë„ {r.prob}</div>
                                        <div className="flex justify-between items-center mb-1">
                                            <span className="font-bold text-gray-800">{r.title}</span>
                                            <div className={`w-11 h-6 rounded-full relative transition-colors ${activeRisks[r.id] ? 'bg-[#FF8D4D]' : 'bg-gray-200'}`}>
                                                <div className={`absolute top-[2px] left-[2px] bg-white border border-gray-300 rounded-full h-5 w-5 transition-transform ${activeRisks[r.id] ? 'translate-x-full border-white' : ''}`}></div>
                                            </div>
                                        </div>
                                        <div className="flex justify-between text-xs text-gray-500"><span>ì˜ˆìƒ ì†ì‹¤ì•¡</span><span className="text-[#E94658] font-bold">-{formatMoney(r.loss)}</span></div>
                                    </div>
                                ))}
                            </div>

                            <div className="p-6 bg-gray-50 border-t border-gray-100">
                                <div className="flex items-center gap-2 text-lg font-bold mb-4 text-gray-800"><Icon d={Icons.Shield} color="#3182F6" /> <span>ì†”ë£¨ì…˜ ì‹œë®¬ë ˆì´í„°</span></div>
                                <div className="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm mb-6">
                                    <div className="text-sm font-bold text-[#3182F6] mb-4">â˜•ï¸ ì›” ì €ì¶•ì„ ëŠ˜ë¦°ë‹¤ë©´?</div>
                                    <input type="range" min="0" max="200" step="10" value={savings} onChange={(e)=>setSavings(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" style={{background: `linear-gradient(to right, #3182F6 ${(savings/200)*100}%, #e5e7eb ${(savings/200)*100}%)`}}/>
                                    <div className="flex justify-between items-center mt-4"><span className="text-xs text-gray-500">ì¶”ê°€ ì €ì¶•ì•¡</span><span className="text-lg font-bold text-[#3182F6]">{savings}ë§Œì›</span></div>
                                </div>
                                
                                {/* êµ¬ë… ë²„íŠ¼ ì„¹ì…˜ */}
                                <div className="bg-[#E8F3FF] p-5 rounded-2xl mb-6">
                                    <div className="flex items-start gap-3">
                                        <div className="bg-white p-2 rounded-full text-[#3182F6]"><Icon d={Icons.Bell} /></div>
                                        <div>
                                            <h3 className="font-bold text-[#3182F6] text-sm mb-1">ë§¤ì£¼ ë¦¬í¬íŠ¸ ë°›ê¸°</h3>
                                            <p className="text-xs text-gray-600 mb-3">ë³€ë™ë˜ëŠ” ìì‚° ìˆ˜ëª…ì„<br/>ë§¤ì£¼ ì•Œë¦¼ìœ¼ë¡œ ì²´í¬í•˜ì„¸ìš”.</p>
                                            <button 
                                                onClick={handleSubscribe} 
                                                disabled={isSubscribed}
                                                className={`w-full py-3 rounded-xl text-sm font-bold transition ${isSubscribed ? 'bg-gray-400 text-white cursor-default' : 'bg-[#3182F6] text-white active:scale-95 shadow-md'}`}
                                            >
                                                {isSubscribed ? 'êµ¬ë… ì¤‘' : 'êµ¬ë…í•˜ê¸°'}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <button onClick={resetAll} className="w-full py-4 bg-white text-gray-600 border border-gray-200 rounded-xl font-bold flex justify-center items-center gap-2 shadow-sm active:scale-95 transition hover:bg-gray-50"><Icon d={Icons.Refresh} /> <span>ë‹¤ì‹œ ì…ë ¥í•˜ê¸°</span></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const LoadingItem = ({ step, current, icon, text }) => {
            const isDone = current > step; const isActive = current === step;
            return (<div className={`flex items-center gap-3 text-[14px] transition-all duration-300 ${isDone || isActive ? 'text-[#191F28] font-semibold' : 'text-[#aaa]'}`}><div className={`w-6 flex justify-center text-center transition-all duration-300`}>{isDone ? <div className="text-[#3182F6]"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div> : <div className="opacity-50">{icon}</div>}</div><span>{text}</span></div>);
        };
        const TabButton = ({ children, active, onClick }) => (<button onClick={onClick} className={`px-3 py-2 rounded-[20px] text-[13px] font-semibold border transition-all ${active ? 'bg-[#191F28] text-white border-[#191F28]' : 'bg-white text-[#888] border-[#eee] hover:bg-gray-50'}`}>{children}</button>);
        const DiagItem = ({ label, value, status, color }) => (<div className="bg-[#F9FAFB] p-[10px] rounded-[10px] text-center"><div className="text-[11px] text-[#888] mb-1">{label}</div><div className="text-[14px] font-bold text-[#191F28]">{value}</div><div className="text-[10px] mt-[2px]" style={{ color: color }}>{status}</div></div>);

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LifePortSimulator />);
        
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').then(reg => console.log('SW registered')).catch(err => console.log('SW failed')); }); }
    </script>
</body>
</html>
