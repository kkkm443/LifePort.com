<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <title>LifePort</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        /* ê¸°ë³¸ ì„¤ì • */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #F2F4F6; }
        body { font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        #root { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        
        @media (min-width: 640px) {
            html, body { height: auto; min-height: 100%; overflow-y: auto; }
            #root { height: auto; min-height: 100vh; padding: 40px 0; }
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #ffffff; border: 2px solid #3182F6;
            box-shadow: 0 2px 6px rgba(49, 130, 246, 0.4); margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; border-radius: 4px;
        }

        /* ì…ë ¥ í¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .input-group label { display: block; font-size: 13px; color: #6b7280; margin-bottom: 6px; font-weight: 600; }
        .input-group input, .input-group select { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e5e7eb; 
            font-size: 16px; font-weight: 500; color: #1f2937; outline: none; transition: all 0.2s;
            background-color: #fff;
        }
        .input-group input:focus, .input-group select:focus { border-color: #3182F6; ring: 2px solid #3182F6; }

        /* ì²´í¬ë°•ìŠ¤ */
        .custom-checkbox {
            width: 24px; height: 24px; border-radius: 50%; border: 2px solid #ddd;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .custom-checkbox.checked { border-color: #3182F6; background-color: #3182F6; }

        /* ë¸”ëŸ¬ ê·¸ë¼ë°ì´ì…˜ */
        .blur-gradient-mask {
            position: relative;
        }
        .blur-gradient-mask::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 20%, rgba(255,255,255,1) 100%);
            backdrop-filter: blur(4px);
            z-index: 10;
            pointer-events: auto; /* í´ë¦­ ë°©ì§€ */
        }
        
        .content-blurred {
            filter: blur(5px);
            opacity: 0.4;
            pointer-events: none;
            user-select: none;
        }

        /* ì ê¸ˆ ì˜¤ë²„ë ˆì´ ì»¨í…Œì´ë„ˆ */
        .lock-overlay-container {
            position: absolute;
            top: 100px; /* ìœ„ì¹˜ ì¡°ì • */
            left: 0; right: 0; bottom: 0;
            z-index: 50;
            display: flex; flex-direction: column; 
            align-items: center;
            padding-top: 40px;
            pointer-events: none; /* ì˜¤ë²„ë ˆì´ ìì²´ëŠ” í´ë¦­ í†µê³¼, ë‚´ë¶€ ë²„íŠ¼ë§Œ í´ë¦­ ê°€ëŠ¥ */
        }
        .lock-overlay-content {
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-[#F2F4F6]">
    <div id="root"></div>

    <script type="text/babel">
        // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
        const Icon = ({ d, size=20, color="currentColor", className="" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>
        );
        
        const Icons = {
            User: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8",
            Alert: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01",
            Shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
            Refresh: "M23 4v6h-6 M1 20v-6h6 M3.51 9a9 9 0 0 1 14.85-3.36L23 10 M1 14l4.64 4.36A9 9 0 0 0 20.49 15",
            Bank: "M3 22h18 M6 18v-7 M10 18v-7 M14 18v-7 M18 18v-7 M12 2l8 5H4z",
            Card: "M1 4h22v16H1z M1 10h22",
            Graph: "M23 6l-9.5 9.5-5-5L1 18",
            Activity: "M22 12h-4l-3 9L9 3l-3 9H2",
            ArrowRight: "M5 12h14 M12 5l7 7-7 7",
            ArrowLeft: "M19 12H5 M12 19l-7-7 7-7",
            Bell: "M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9 M13.73 21a2 2 0 0 1-3.46 0",
            Link: "M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",
            Check: "M20 6L9 17l-5-5",
            X: "M18 6L6 18M6 6l12 12",
            Coffee: "M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8zM6 1v3M10 1v3M14 1v3",
            Shopping: "M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4zM3 6h18M16 10a4 4 0 0 1-8 0",
            Game: "M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z",
            Piggy: "M19 14c1.49-1.28 3.6-2.34 3.6-4.55C22.6 5.11 17 5 17 5V2h-2v3H9V2H7v3c0 0-5.6.11-5.6 4.45 0 2.21 2.11 3.27 3.6 4.55-1 1.78-.97 3.52 0 4.64C5 20.5 7 22 12 22s7-1.5 7-3.36c.97-1.12 1-2.86 0-4.64z M10 13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2 2-2-.9-2-2z",
            Lock: "M12 15v2m-6 4h12a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2zm10-10V7a4 4 0 0 0-8 0v4h8z",
            Mail: "M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z M22 6l-10 7L2 6",
            Chat: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",
            Home: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z M9 22V12h6v10",
            Menu: "M3 12h18M3 6h18M3 18h18",
            Wallet: "M20 7h-3a2 2 0 0 1-2-2V3 M9 9h6 M9 13h6 M1 21h22V7H1v14z",
            Gift: "M20 12v10H4V12 M2 7h20v5H2z M12 22V7 M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"
        };

        const PRODUCT_DATA = {
            'deposit': {
                title: 'ğŸ’° ì•ˆì •ì ì¸ ì˜ˆ/ì ê¸ˆ',
                desc: 'ì›ê¸ˆ ì†ì‹¤ ê±±ì • ì—†ì´ ì°¨ê³¡ì°¨ê³¡',
                items: [
                    { id: 1, name: 'ë¼ì´í”„ íŒŒí‚¹í†µì¥', bank: 'ë¼ì´í”„ë±…í¬', rate: 'ì—° 3.5%', tag: 'ìˆ˜ì‹œì…ì¶œê¸ˆ', highlight: true },
                    { id: 2, name: 'ê°“ìƒ ì‘ì› ì ê¸ˆ', bank: 'ìœ ë‹ˆë²„ìŠ¤ì€í–‰', rate: 'ìµœê³  ì—° 7.0%', tag: 'ì²­ë…„ìš°ëŒ€' },
                    { id: 3, name: 'ëª©ëˆë§ˆë ¨ ì •ê¸°ì˜ˆê¸ˆ', bank: 'ì†”ë¼ê¸ˆìœµ', rate: 'ì—° 4.2%', tag: '12ê°œì›”' },
                    { id: 4, name: 'ë‹¨ê¸° ì˜ˆê¸ˆ (3ê°œì›”)', bank: 'ìŠ¤ë§ˆíŠ¸ì €ì¶•ì€í–‰', rate: 'ì—° 3.8%', tag: 'ë‹¨ê¸°ìê¸ˆ' },
                    { id: 5, name: 'ììœ ì ê¸ˆ', bank: 'ë°ì¼ë¦¬ë±…í¬', rate: 'ì—° 4.0%', tag: 'ë§¤ì¼ì €ì¶•' }
                ]
            },
            'etf': {
                title: 'ğŸ“ˆ ì„±ì¥í•˜ëŠ” ETF/í€ë“œ',
                desc: 'ë¬¼ê°€ìƒìŠ¹ë¥ ì„ ì´ê¸°ëŠ” íˆ¬ì',
                items: [
                    { id: 1, name: 'ë¯¸êµ­ í…Œí¬ TOP10', company: 'ë¯¸ë˜ì—ì…‹', rate: '+24.5%', period: '1ë…„ ìˆ˜ìµë¥ ', tag: 'ê³µê²©íˆ¬ìí˜•', highlight: true },
                    { id: 2, name: 'S&P 500 ì¶”ì¢…', company: 'í•œêµ­íˆ¬ì', rate: '+12.1%', period: '1ë…„ ìˆ˜ìµë¥ ', tag: 'ì‹œì¥ëŒ€í‘œ' },
                    { id: 3, name: 'ë°°ë‹¹ê·€ì¡± ë¦¬ì¸ ', company: 'KBìì‚°', rate: '+5.8%', period: 'ë°°ë‹¹ìˆ˜ìµë¥ ', tag: 'ì›”ë°°ë‹¹' },
                    { id: 4, name: 'ë°˜ë„ì²´ ì†Œë¶€ì¥', company: 'ì‚¼ì„±ìì‚°', rate: '+15.2%', period: '6ê°œì›” ìˆ˜ìµë¥ ', tag: 'ì„¹í„°íˆ¬ì' }
                ]
            },
            'pension': {
                title: 'ğŸ›¡ï¸ ë“ ë“ í•œ ë…¸í›„ ì—°ê¸ˆ',
                desc: 'ì ˆì„¸ í˜œíƒê³¼ ë…¸í›„ ì¤€ë¹„ë¥¼ ë™ì‹œì—',
                items: [
                    { id: 1, name: 'ì„¸ì•¡ê³µì œ ì—°ê¸ˆì €ì¶•', company: 'ì‚¼ì„±ìƒëª…', info: 'ì—°ë§ì •ì‚° í™˜ê¸‰', tag: 'ì ˆì„¸í•„ìˆ˜', highlight: true },
                    { id: 2, name: 'í‰ìƒ ì†Œë“ TDF 2055', company: 'ë¯¸ë˜ì—ì…‹', info: 'ì€í‡´ì‹œì  ìë™ìš´ìš©', tag: 'ìë™ê´€ë¦¬' },
                    { id: 3, name: 'ë‹¤ì´ë ‰íŠ¸ ì—°ê¸ˆë³´í—˜', company: 'êµë³´ë¼ì´í”„', info: 'ë¹„ê³¼ì„¸ í˜œíƒ', tag: 'ë…¸í›„ì¤€ë¹„' },
                    { id: 4, name: 'IRP í‡´ì§ì—°ê¸ˆ', company: 'í•˜ë‚˜ì€í–‰', info: 'ììœ ë¡œìš´ ìš´ìš©', tag: 'í‡´ì§ê¸ˆê´€ë¦¬' }
                ]
            }
        };

        const mockAccounts = [
            { id: 1, bank: 'KBêµ­ë¯¼', name: 'ONEí†µì¥-ì €ì¶•ì˜ˆê¸ˆ', balance: 4500000, icon: 'ğŸŸ¡' },
            { id: 2, bank: 'ìš°ë¦¬', name: 'WON í†µì¥', balance: 2100000, icon: 'ğŸ”µ' },
            { id: 3, bank: 'ì¹´ì¹´ì˜¤ë±…í¬', name: 'ì…ì¶œê¸ˆí†µì¥', balance: 850000, icon: 'ğŸŸ¡' },
            { id: 4, bank: 'í† ìŠ¤ë±…í¬', name: 'í† ìŠ¤ë±…í¬ í†µì¥', balance: 3200000, icon: 'ğŸ”µ' },
            { id: 5, bank: 'ì‹ í•œ', name: 'ì í¸í•œ ì…ì¶œê¸ˆ', balance: 1500000, icon: 'ğŸ”µ' },
            { id: 6, bank: 'NHë†í˜‘', name: 'ì±„ì›€ê³µì§ììš°ëŒ€', balance: 1200000, icon: 'ğŸŸ¢' }
        ];

        const habitCategories = {
            'cafe': { title: 'ì¹´í˜/ë””ì €íŠ¸ ëŸ¬ë²„', icon: Icons.Coffee, color: 'text-brown-500', bg: 'bg-brown-50' },
            'delivery': { title: 'ë°°ë‹¬ìŒì‹ ë§¤ë‹ˆì•„', icon: Icons.Shopping, color: 'text-red-500', bg: 'bg-red-50' },
            'shopping': { title: 'ì˜¨ë¼ì¸ ì‡¼í¼í™€ë¦­', icon: Icons.Shopping, color: 'text-purple-500', bg: 'bg-purple-50' },
            'game': { title: 'ê²œì£¼ë‹˜(ê²Œì„/ì·¨ë¯¸)', icon: Icons.Game, color: 'text-indigo-500', bg: 'bg-indigo-50' },
        };

        const analyzeMockTransactions = (selectedIds) => {
            const totalAssetsFound = mockAccounts.filter(acc => selectedIds.includes(acc.id)).reduce((sum, acc) => sum + acc.balance, 0);
            const habits = Object.keys(habitCategories);
            const randomHabitKey = habits[Math.floor(Math.random() * habits.length)];
            
            let estimatedMonthlyExpense = Math.round((totalAssetsFound * (Math.random() * 0.05 + 0.03)) / 10000) * 10000; 
            if (estimatedMonthlyExpense < 1000000) estimatedMonthlyExpense = 1000000 + Math.round(Math.random()*50)*10000;

            let estimatedMonthlyIncome = Math.round(estimatedMonthlyExpense * (1.3 + Math.random() * 0.5));
            if (estimatedMonthlyIncome < 2000000) estimatedMonthlyIncome = 2000000 + Math.round(Math.random()*50)*10000;

            return {
                totalAssets: Math.round(totalAssetsFound / 10000), 
                monthlyExpense: Math.round(estimatedMonthlyExpense / 10000), 
                monthlyIncome: Math.round(estimatedMonthlyIncome / 10000), 
                habit: randomHabitKey
            };
        };

        const getPeerAvgSavings = (age) => {
            if (age < 30) return 86;  
            if (age < 40) return 124; 
            if (age < 50) return 162; 
            return 178;               
        };

        const getPortfolioSuggestion = (age, amount) => {
            if (amount <= 0) return { type: '', items: [] };
            
            let type = '';
            let ratios = { safe: 0, stock: 0, etf: 0, pension: 0 };
            
            if (age < 40) {
                type = 'ì„±ì¥í˜•';
                ratios = { safe: 20, stock: 30, etf: 30, pension: 20 };
            } else if (age < 50) {
                type = 'ì¤‘ë¦½í˜•';
                ratios = { safe: 40, stock: 20, etf: 20, pension: 20 };
            } else {
                type = 'ì•ˆì •í˜•';
                ratios = { safe: 60, stock: 10, etf: 10, pension: 20 };
            }

            return {
                type: type,
                items: [
                    { id: 'safe', name: 'ì˜ˆÂ·ì ê¸ˆ', ratio: ratios.safe, amount: Math.round(amount * (ratios.safe/100)), color: 'bg-blue-500' },
                    { id: 'etf', name: 'ETF/í€ë“œ', ratio: ratios.etf, amount: Math.round(amount * (ratios.etf/100)), color: 'bg-purple-500' },
                    { id: 'stock', name: 'ì£¼ì‹', ratio: ratios.stock, amount: Math.round(amount * (ratios.stock/100)), color: 'bg-red-500' },
                    { id: 'pension', name: 'ì—°ê¸ˆë³´í—˜', ratio: ratios.pension, amount: Math.round(amount * (ratios.pension/100)), color: 'bg-green-500' }
                ]
            };
        };


        const LifePortSimulator = () => {
            const [screen, setScreen] = React.useState('intro'); 
            const [loadingStep, setLoadingStep] = React.useState(0);
            
            // Home Screen State
            const [homeTab, setHomeTab] = React.useState('home');
            const [showPromo, setShowPromo] = React.useState(true);

            const [inputData, setInputData] = React.useState({
                age: 30, jobType: 'office', monthlyIncome: 300, totalAssets: '', monthlyExpense: ''
            });

            const [myDataStep, setMyDataStep] = React.useState('select'); 
            const [selectedAccounts, setSelectedAccounts] = React.useState([]);
            const [analyzedData, setAnalyzedData] = React.useState(null);
            
            const [selectedProductType, setSelectedProductType] = React.useState(null);

            const resultScrollPos = React.useRef(0);
            const resultContainerRef = React.useRef(null);

            const [profile, setProfile] = React.useState(null);
            const [simulationResult, setSimulationResult] = React.useState(null);
            const [lifestyle, setLifestyle] = React.useState('standard'); 
            const [activeRisks, setActiveRisks] = React.useState({}); 
            const [savings, setSavings] = React.useState(0); 
            const [isSubscribed, setIsSubscribed] = React.useState(false);

            const [isLoggedIn, setIsLoggedIn] = React.useState(false);

            // íšŒì›ê°€ì… í¼ ìƒíƒœ
            const [signupForm, setSignupForm] = React.useState({ name: '', id: '', password: '' });

            const jobTraits = {
                office: { title: 'ì§ì¥ì¸', retirementAge: 60, investMin: 2, investMax: 4 },
                free: { title: 'í”„ë¦¬ëœì„œ', retirementAge: 65, investMin: 2, investMax: 5 },
                civil: { title: 'ê³µë¬´ì›', retirementAge: 60, investMin: 1.5, investMax: 3 },
                startup: { title: 'ì°½ì—…/ì‚¬ì—…ê°€', retirementAge: 65, investMin: 1, investMax: 6 },
                pro: { title: 'ì „ë¬¸ì§', retirementAge: 68, investMin: 2.5, investMax: 5.5 }
            };

            const riskScenarios = {
                20: [{ id: 'marriage', title: 'ğŸ’ ê²°í˜¼/ë…ë¦½ ì¤€ë¹„', loss: 8000, prob: '70%', period: 7 }, { id: 'car', title: 'ğŸš— ì°¨ëŸ‰ í• ë¶€ êµ¬ë§¤', loss: 3000, prob: '60%', period: 5 }],
                30: [{ id: 'housing', title: 'ğŸ  ì£¼íƒ ëŒ€ì¶œ ì´ì', loss: 30000, prob: '50%', period: 20 }, { id: 'child', title: 'ğŸ‘¶ ìœ¡ì•„ ë¹„ìš©', loss: 4000, prob: '40%', period: 5 }],
                40: [{ id: 'education', title: 'ğŸ“ ìë…€ êµìœ¡ë¹„', loss: 12000, prob: '80%', period: 8 }, { id: 'medical', title: 'ğŸ¥ ê°€ì¡± ì˜ë£Œë¹„', loss: 5000, prob: '24%' }],
                50: [{ id: 'business', title: 'ğŸ“‰ íˆ¬ì/ì‚¬ì—… ì†ì‹¤', loss: 15000, prob: '30%' }, { id: 'job', title: 'ğŸ’¼ ì¡°ê¸° í‡´ì§', loss: 5000, prob: '15%' }],
                60: [{ id: 'health', title: 'ğŸ¥ ë…¸í›„ ì˜ë£Œë¹„', loss: 8000, prob: '35%', period: 10 }, { id: 'scam', title: 'ğŸ’¸ ì‚¬ê¸°/ë¶„ìŸ', loss: 10000, prob: '15%' }]
            };

            const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const formatMoney = (val) => val >= 10000 ? (val/10000).toFixed(1).replace('.0','') + 'ì–µ' : val.toLocaleString() + 'ë§Œì›';

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                if (name === 'jobType') {
                    setInputData(prev => ({ ...prev, [name]: value }));
                } else {
                    setInputData(prev => ({ ...prev, [name]: value === '' ? '' : Number(value) }));
                }
            };
            
            const handleSignupInput = (e) => {
                setSignupForm({...signupForm, [e.target.name]: e.target.value});
            };

            // ... ê¸°ì¡´ í•¨ìˆ˜ë“¤ ...
            const startMyDataFlow = () => { setScreen('mydata'); setMyDataStep('select'); setSelectedAccounts([]); setAnalyzedData(null); };
            const toggleAccountSelection = (id) => { setSelectedAccounts(prev => prev.includes(id) ? prev.filter(accId => accId !== id) : [...prev, id]); };
            const proceedToConnection = () => {
                if (selectedAccounts.length === 0) return;
                setMyDataStep('connecting');
                setTimeout(() => { setMyDataStep('analyzing'); setTimeout(() => {
                    const result = analyzeMockTransactions(selectedAccounts);
                    setAnalyzedData(result);
                    setMyDataStep('complete');
                }, 2000); }, 1500);
            };
            const applyMyDataResult = () => {
                if (analyzedData) {
                    setInputData(prev => ({ ...prev, totalAssets: analyzedData.totalAssets, monthlyExpense: analyzedData.monthlyExpense, monthlyIncome: analyzedData.monthlyIncome }));
                    setProfile(prev => ({...createProfileFromInput(), habit: analyzedData.habit}));
                }
                setScreen('input');
            };
            const createProfileFromInput = () => {
                const trait = jobTraits[inputData.jobType];
                const safeInput = { age: Number(inputData.age) || 30, monthlyIncome: Number(inputData.monthlyIncome) || 0, monthlyExpense: Number(inputData.monthlyExpense) || 0, totalAssets: Number(inputData.totalAssets) || 0 };
                const ageKey = Math.floor(safeInput.age/10)*10;
                const safeAgeKey = (ageKey > 60) ? 60 : (ageKey < 20 ? 20 : ageKey);
                return { age: safeInput.age, job: trait.title, monthlyIncome: safeInput.monthlyIncome, baseMonthlyExpense: safeInput.monthlyExpense, totalAssets: safeInput.totalAssets, totalDebt: 0, risks: riskScenarios[safeAgeKey] || riskScenarios[40], retirementAge: trait.retirementAge, investmentReturn: rand(trait.investMin * 10, trait.investMax * 10) / 10, habit: analyzedData ? analyzedData.habit : null };
            };
            const runSimulation = () => {
                if (!profile) return;
                const INFLATION_RATE = 0.03; const INCOME_GROWTH_RATE = 0.03; const TAX_RATE = 0.154;
                let assets = profile.totalAssets; let isBankrupt = false; let bankruptAge = 100;
                let lifestyleMult = lifestyle === 'basic' ? 0.85 : (lifestyle === 'rich' ? 1.2 : 1.0);
                const isEarlyRetired = activeRisks['job'];
                const effectiveRetirementAge = isEarlyRetired ? profile.age : profile.retirementAge;
                Object.keys(activeRisks).forEach(id => { if(activeRisks[id]) { const risk = profile.risks.find(r=>r.id===id); if (!risk.period) assets -= risk.loss; } });
                for (let age = profile.age; age <= 100; age++) {
                    const yearIndex = age - profile.age;
                    let yearlyIncome = 0;
                    if (age <= effectiveRetirementAge) { yearlyIncome = (profile.monthlyIncome * 12) * Math.pow(1 + INCOME_GROWTH_RATE, yearIndex); } 
                    else { const basePension = Math.min(profile.monthlyIncome * 0.4, 200); yearlyIncome = (basePension * 12) * Math.pow(1 + INFLATION_RATE, yearIndex); }
                    let currentBaseExpense = (profile.baseMonthlyExpense * lifestyleMult);
                    let currentAdditionalSavings = savings * Math.pow(1 + INFLATION_RATE, yearIndex); 
                    let minLivingBase = (60 * lifestyleMult) + (age - 30) * 0.5; 
                    let minLivingInflated = minLivingBase * Math.pow(1 + INFLATION_RATE, yearIndex);
                    let realMonthlyExpense = currentBaseExpense - currentAdditionalSavings;
                    if (realMonthlyExpense < minLivingInflated) realMonthlyExpense = minLivingInflated;
                    let annualExp = realMonthlyExpense * 12 * Math.pow(1 + INFLATION_RATE, yearIndex);
                    Object.keys(activeRisks).forEach(id => { if(activeRisks[id]) { const risk = profile.risks.find(r=>r.id===id); if (risk.period && age < profile.age + risk.period) { annualExp += (risk.loss / risk.period) * Math.pow(1 + INFLATION_RATE, yearIndex); } } });
                    let rawReturnRate = (age <= effectiveRetirementAge) ? profile.investmentReturn : (profile.investmentReturn * 0.7);
                    let investmentGain = (assets > 0) ? assets * (rawReturnRate / 100) * (1 - TAX_RATE) : 0;
                    assets += yearlyIncome - annualExp + investmentGain;
                    if (assets < 0) { isBankrupt = true; bankruptAge = age; break; }
                }
                setSimulationResult({ isBankrupt, bankruptAge });
            };
            React.useEffect(() => { if (profile) runSimulation(); }, [profile, lifestyle, activeRisks, savings]);
            React.useEffect(() => {
                if (screen === 'result' && resultContainerRef.current) {
                    setTimeout(() => { if (resultContainerRef.current) { resultContainerRef.current.scrollTop = resultScrollPos.current; } }, 0);
                }
            }, [screen]);

            const startAnalysis = () => {
                setProfile(createProfileFromInput()); 
                setScreen('loading'); setLoadingStep(0);
                setTimeout(()=>setLoadingStep(1), 500); setTimeout(()=>setLoadingStep(2), 1000);
                setTimeout(()=>setLoadingStep(3), 1500); setTimeout(()=>{ setLoadingStep(4); }, 2000);
                setTimeout(()=>setScreen('result'), 2500);
            };
            const toggleRisk = (id) => setActiveRisks(p => ({...p, [id]: !p[id]}));
            const getStatus = (age) => {
                if(age>=100) return {color:'text-green-600', bg:'bg-green-50', bar:'bg-green-500', msg:'ì•ˆì „ ìƒíƒœ'};
                if(age>=80) return {color:'text-blue-600', bg:'bg-blue-50', bar:'bg-blue-500', msg:'ë³´í†µ ìƒíƒœ'};
                if(age>=70) return {color:'text-orange-600', bg:'bg-orange-50', bar:'bg-orange-500', msg:'ì£¼ì˜ í•„ìš”'};
                return {color:'text-red-600', bg:'bg-red-50', bar:'bg-red-500', msg:'ìœ„í—˜ ê²½ê³ '};
            };
            const resetAll = () => { 
                setScreen('intro'); setProfile(null); setSimulationResult(null); setAnalyzedData(null);
                setActiveRisks({}); setSavings(0); setLifestyle('standard'); setIsSubscribed(false); 
                setInputData({ age: 30, jobType: 'office', monthlyIncome: 300, totalAssets: '', monthlyExpense: '' });
                setSelectedProductType(null); resultScrollPos.current = 0; 
            };
            const handleSubscribe = () => { setIsSubscribed(true); alert("âœ… êµ¬ë… ì™„ë£Œ! ë§¤ì£¼ ë¦¬í¬íŠ¸ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤."); };
            const handleProductClick = (typeKey) => { 
                if (resultContainerRef.current) { resultScrollPos.current = resultContainerRef.current.scrollTop; }
                setSelectedProductType(typeKey); setScreen('product');
            };
            const goToSignup = () => { setScreen('signup'); };
            const completeSignup = () => { 
                if (!signupForm.name || !signupForm.id || !signupForm.password) { alert('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
                setIsLoggedIn(true); setScreen('home'); 
            };

            // í™ˆ í™”ë©´ìš© ê³„ì‚°
            const displayAssets = analyzedData ? analyzedData.totalAssets * 10000 : (inputData.totalAssets ? inputData.totalAssets * 10000 : 54200000);
            const formattedDisplayAssets = Math.round(displayAssets/10000).toLocaleString();

            return (
                <div className="w-full max-w-[420px] bg-white shadow-2xl overflow-hidden flex flex-col h-full sm:h-[85vh] sm:max-h-[900px] sm:rounded-[32px] sm:border-[8px] sm:border-white relative transition-all">
                    
                    {/* --- [í™ˆ í™”ë©´] (ì‚¬ìš©ì ì œê³µ ë””ìì¸ ì ìš©) --- */}
                    {screen === 'home' && (
                        <div className="flex-1 flex flex-col bg-[#F2F4F6] animate-fade-in relative h-full overflow-hidden">
                            
                            {/* í”„ë¡œëª¨ì…˜ ëª¨ë‹¬ */}
                            {showPromo && (
                                <div className="absolute inset-0 bg-black/50 z-50 flex items-center justify-center p-6 animate-fade-in">
                                    <div className="bg-white rounded-3xl p-6 max-w-sm w-full relative shadow-2xl">
                                        <button onClick={() => setShowPromo(false)} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                                            <Icon d={Icons.X} size={24} />
                                        </button>
                                        <div className="text-center mb-6">
                                            <div className="text-5xl mb-4">ğŸ</div>
                                            <h3 className="text-xl mb-2 font-bold text-gray-800">
                                                <span className="text-[#3182F6]">{signupForm.name || 'ê²½ê²½ê²½'}</span>ë‹˜ì„ ìœ„í•œ<br />
                                                ë§ì¶¤ í˜œíƒ ì •ë³´
                                            </h3>
                                            <p className="text-sm text-gray-500">
                                                {signupForm.name || 'ê²½ê²½ê²½'}ë‹˜ê³¼ ê¼­ ë§ëŠ” ìƒí’ˆê³¼ ê¸ˆìœµ ì†Œì‹<br />
                                                ë†“ì¹˜ë©´ ì•„ì‰¬ìš´ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•´ë“œë¦´ê²Œìš”
                                            </p>
                                        </div>
                                        <div className="space-y-2 mb-6">
                                            <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                                <div className="flex items-center gap-2 text-sm">
                                                    <span className="text-[#3182F6] font-bold">âœ“</span>
                                                    <span>ìƒí’ˆ ì„œë¹„ìŠ¤ ì•ˆë‚´ ë° ì´ìš©ê¶Œìœ  ë™ì˜</span>
                                                </div>
                                                <span className="text-xs text-white bg-green-500 px-2 py-1 rounded font-bold">ì„ íƒ</span>
                                            </div>
                                            <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                                <div className="flex items-center gap-2 text-sm">
                                                    <span className="text-[#3182F6] font-bold">âœ“</span>
                                                    <span>ê´‘ê³ ì„± ìˆ˜ì‹ ì˜ ì—´ëŒì‹œ</span>
                                                </div>
                                                <span className="text-xs text-white bg-green-500 px-2 py-1 rounded font-bold">ì„ íƒ</span>
                                            </div>
                                        </div>
                                        <button onClick={() => setShowPromo(false)} className="w-full py-3 bg-[#E8EDF5] text-[#3182F6] font-bold rounded-xl text-sm mb-2 hover:bg-[#dbe3ef] transition">
                                            ëª¨ë‘ ë™ì˜í•˜ê³  ì¶”ì²œë°›ê¸°
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */}
                            <div className="flex-1 overflow-y-auto pb-24 hide-scrollbar">
                                
                                {/* 1. í™ˆ íƒ­ ì½˜í…ì¸  */}
                                {homeTab === 'home' && (
                                    <>
                                        {/* í—¤ë” */}
                                        <div className="bg-white px-6 py-4 flex items-center justify-between sticky top-0 z-10 border-b border-gray-50">
                                            <div className="flex items-center gap-2">
                                                <div className="text-2xl">ğŸ’°</div>
                                                <span className="text-xl font-bold">LifePort</span>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                <button className="relative">
                                                    <Icon d={Icons.Bell} size={24} className="text-gray-600" />
                                                    <span className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-white text-[10px] flex items-center justify-center font-bold">3</span>
                                                </button>
                                                <button>
                                                    <Icon d={Icons.Menu} size={24} className="text-gray-600" />
                                                </button>
                                            </div>
                                        </div>

                                        <div className="px-6 py-4 space-y-6">
                                            {/* ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì•¡ì…˜ */}
                                            <div className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-6 text-white relative overflow-hidden shadow-lg">
                                                <div className="text-xs bg-white/20 inline-block px-2 py-1 rounded mb-3 backdrop-blur-sm">ì˜¤ëŠ˜ì˜ ì¶”ì²œ</div>
                                                <h3 className="text-xl mb-2 font-bold leading-snug">
                                                    <span>{signupForm.name || 'ê²½ê²½ê²½'}</span>ë‹˜, ìì‚° ìˆ˜ëª…<br />
                                                    10ë…„ ëŠ˜ë¦¬ëŠ” ë°©ë²• í™•ì¸í•˜ì„¸ìš”! ğŸ¯
                                                </h3>
                                                <p className="text-sm text-white/80 mb-4">ë§ì¶¤ í¬íŠ¸í´ë¦¬ì˜¤ì™€ ì ˆì„¸ ì „ëµ</p>
                                                <button onClick={() => setScreen('result')} className="bg-white text-[#3182F6] px-4 py-2 rounded-xl text-sm font-bold inline-flex items-center gap-2 hover:bg-gray-50 transition shadow-sm">
                                                    <span>ì§€ê¸ˆ í™•ì¸í•˜ê¸°</span>
                                                    <Icon d={Icons.ArrowRight} size={16} />
                                                </button>
                                                <div className="absolute -right-8 -bottom-8 text-8xl opacity-20 select-none">ğŸ“Š</div>
                                            </div>

                                            {/* ê´‘ê³  ë°°ë„ˆ */}
                                            <div className="bg-gradient-to-r from-green-400 to-teal-500 rounded-3xl p-6 text-white relative overflow-hidden shadow-md">
                                                <div className="text-xs bg-white/20 inline-block px-2 py-1 rounded mb-2 backdrop-blur-sm">ê´‘ê³ </div>
                                                <h3 className="text-lg mb-1 font-bold">ì—°ë§ ì ˆì„¸ ë§ˆê° ì„ë°•! ğŸ„</h3>
                                                <p className="text-sm text-white/90 mb-4">ìµœëŒ€ 16.5% ì„¸ì•¡ê³µì œ ë°›ëŠ” ë°©ë²•</p>
                                                <button className="text-sm text-white underline font-medium hover:text-white/80">ìì„¸íˆ ë³´ê¸° â†’</button>
                                                <div className="absolute -right-4 -bottom-4 text-7xl opacity-30 select-none">ğŸ</div>
                                            </div>

                                            {/* ë¹ ë¥¸ ì‹¤í–‰ ë²„íŠ¼ë“¤ */}
                                            <div className="grid grid-cols-4 gap-4">
                                                <button onClick={() => setScreen('result')} className="flex flex-col items-center justify-center p-4 bg-white rounded-2xl shadow-sm active:scale-95 transition hover:shadow-md">
                                                    <div className="text-3xl mb-2">ğŸ“Š</div>
                                                    <span className="text-xs text-gray-600 font-medium">ìì‚°ë¶„ì„</span>
                                                </button>
                                                <button onClick={() => handleProductClick('deposit')} className="flex flex-col items-center justify-center p-4 bg-white rounded-2xl shadow-sm active:scale-95 transition hover:shadow-md">
                                                    <div className="text-3xl mb-2">ğŸ’°</div>
                                                    <span className="text-xs text-gray-600 font-medium">ì˜ˆì ê¸ˆ</span>
                                                </button>
                                                <button onClick={() => handleProductClick('etf')} className="flex flex-col items-center justify-center p-4 bg-white rounded-2xl shadow-sm active:scale-95 transition hover:shadow-md">
                                                    <div className="text-3xl mb-2">ğŸ“ˆ</div>
                                                    <span className="text-xs text-gray-600 font-medium">íˆ¬ììƒí’ˆ</span>
                                                </button>
                                                <button onClick={() => alert('ì¤€ë¹„ ì¤‘ì¸ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤!')} className="flex flex-col items-center justify-center p-4 bg-white rounded-2xl shadow-sm active:scale-95 transition hover:shadow-md">
                                                    <div className="text-3xl mb-2">ğŸ</div>
                                                    <span className="text-xs text-gray-600 font-medium">ì´ë²¤íŠ¸</span>
                                                </button>
                                            </div>

                                            {/* ë‚´ ìì‚° ìš”ì•½ */}
                                            <div className="bg-white rounded-3xl p-6 shadow-sm">
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="text-lg font-bold text-gray-800">ë‚´ ìì‚°</h3>
                                                    <button className="text-sm text-gray-500 hover:text-gray-800">ìì„¸íˆ â†’</button>
                                                </div>
                                                <div className="space-y-4">
                                                    <div>
                                                        <div className="text-sm text-gray-500 mb-1">ì´ ìì‚°</div>
                                                        <div className="text-3xl font-bold text-gray-900">{formattedDisplayAssets}<span className="text-xl text-gray-500 font-normal">ë§Œì›</span></div>
                                                    </div>
                                                    <div className="flex gap-4">
                                                        <div className="flex-1">
                                                            <div className="text-xs text-gray-500 mb-1">ì´ë²ˆ ë‹¬ ì†Œë“</div>
                                                            <div className="text-lg font-bold text-blue-600">+{analyzedData ? analyzedData.monthlyIncome : inputData.monthlyIncome}ë§Œì›</div>
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="text-xs text-gray-500 mb-1">ì´ë²ˆ ë‹¬ ì§€ì¶œ</div>
                                                            <div className="text-lg font-bold text-red-600">-{analyzedData ? analyzedData.monthlyExpense : inputData.monthlyExpense}ë§Œì›</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ì—°ê²°ëœ ê³„ì¢Œ */}
                                            <div className="bg-white rounded-3xl p-6 shadow-sm">
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="text-lg font-bold text-gray-800">ì—°ê²°ëœ ê³„ì¢Œ</h3>
                                                    <button onClick={startMyDataFlow} className="text-sm text-[#3182F6] font-bold hover:bg-blue-50 px-2 py-1 rounded transition">+ ì¶”ê°€</button>
                                                </div>
                                                <div className="space-y-3">
                                                    {mockAccounts.slice(0, 2).map(acc => (
                                                        <div key={acc.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition cursor-pointer">
                                                            <div>
                                                                <div className="text-sm font-bold text-gray-800 mb-1">{acc.bank}</div>
                                                                <div className="text-xs text-gray-500">***-**-******</div>
                                                            </div>
                                                            <div className="text-lg font-bold text-gray-900">{acc.balance.toLocaleString()}ì›</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* ì¶”ì²œ ê¸ˆìœµ ìƒí’ˆ */}
                                            <div>
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="text-lg font-bold text-gray-800"><span>{signupForm.name || 'ê²½ê²½ê²½'}</span>ë‹˜ ë§ì¶¤ ìƒí’ˆ</h3>
                                                    <button className="text-sm text-gray-500 hover:text-gray-800">ì „ì²´ë³´ê¸° â†’</button>
                                                </div>
                                                <div className="space-y-3">
                                                    <div onClick={() => handleProductClick('deposit')} className="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-5 text-white shadow-md cursor-pointer hover:shadow-lg transition">
                                                        <div className="text-xs bg-white/20 inline-block px-2 py-1 rounded mb-2 font-bold backdrop-blur-sm">ìˆ˜ì‹œì…ì¶œê¸ˆ</div>
                                                        <h4 className="text-lg font-bold mb-1">ë¼ì´í”„ íŒŒí‚¹í†µì¥</h4>
                                                        <p className="text-sm text-white/90 mb-3">ì—° 3.5% ê³ ê¸ˆë¦¬</p>
                                                        <button className="text-sm bg-white text-gray-800 px-4 py-2 rounded-lg font-bold hover:bg-gray-50">ìì„¸íˆ ë³´ê¸°</button>
                                                    </div>
                                                    <div onClick={() => handleProductClick('etf')} className="bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl p-5 text-white shadow-md cursor-pointer hover:shadow-lg transition">
                                                        <div className="text-xs bg-white/20 inline-block px-2 py-1 rounded mb-2 font-bold backdrop-blur-sm">ê³µê²©íˆ¬ìí˜•</div>
                                                        <h4 className="text-lg font-bold mb-1">ë¯¸êµ­ í…Œí¬ TOP10 ETF</h4>
                                                        <p className="text-sm text-white/90 mb-3">1ë…„ ìˆ˜ìµë¥  +24.5%</p>
                                                        <button className="text-sm bg-white text-gray-800 px-4 py-2 rounded-lg font-bold hover:bg-gray-50">ìì„¸íˆ ë³´ê¸°</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </>
                                )}

                                {/* 2. ë¶„ì„ íƒ­ */}
                                {homeTab === 'analysis' && (
                                    <div className="flex-1 flex flex-col items-center justify-center p-8 bg-white min-h-[80vh]">
                                        <div className="text-6xl mb-4">ğŸ“Š</div>
                                        <h2 className="text-2xl font-bold mb-2">ë¶„ì„</h2>
                                        <p className="text-gray-500 text-center mb-6">
                                            ë¶„ì„ ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.<br />
                                            ê³§ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                                        </p>
                                        <button onClick={() => setScreen('result')} className="px-6 py-3 bg-[#3182F6] text-white rounded-xl shadow-lg active:scale-95 transition font-bold">
                                            ìì‚° ìˆ˜ëª… ë¶„ì„ ë³´ê¸°
                                        </button>
                                    </div>
                                )}

                                {/* 3. ê°€ê³„ë¶€ íƒ­ */}
                                {homeTab === 'ledger' && (
                                    <div className="flex-1 flex flex-col items-center justify-center p-8 bg-white min-h-[80vh]">
                                        <div className="text-6xl mb-4">ğŸ“’</div>
                                        <h2 className="text-2xl font-bold mb-2">ê°€ê³„ë¶€</h2>
                                        <p className="text-gray-500 text-center mb-6">
                                            ê°€ê³„ë¶€ ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.<br />
                                            ê³§ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                                        </p>
                                        <button onClick={() => setScreen('result')} className="px-6 py-3 bg-[#3182F6] text-white rounded-xl shadow-lg active:scale-95 transition font-bold">
                                            ìì‚° ìˆ˜ëª… ë¶„ì„ ë³´ê¸°
                                        </button>
                                    </div>
                                )}

                                {/* 4. ë¦¬í¬íŠ¸ íƒ­ */}
                                {homeTab === 'report' && (
                                    <div className="flex-1 flex flex-col items-center justify-center p-8 bg-white min-h-[80vh]">
                                        <div className="text-6xl mb-4">ğŸ“ˆ</div>
                                        <h2 className="text-2xl font-bold mb-2">ë¦¬í¬íŠ¸</h2>
                                        <p className="text-gray-500 text-center mb-6">
                                            ë¦¬í¬íŠ¸ ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.<br />
                                            ê³§ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                                        </p>
                                        <button onClick={() => setScreen('result')} className="px-6 py-3 bg-[#3182F6] text-white rounded-xl shadow-lg active:scale-95 transition font-bold">
                                            ìì‚° ìˆ˜ëª… ë¶„ì„ ë³´ê¸°
                                        </button>
                                    </div>
                                )}

                                {/* 5. ë§ˆì´í˜ì´ì§€ íƒ­ */}
                                {homeTab === 'my' && (
                                    <div className="flex-1 flex flex-col items-center justify-center p-8 bg-white min-h-[80vh]">
                                        <div className="text-6xl mb-4">ğŸ‘¤</div>
                                        <h2 className="text-2xl font-bold mb-2">ë§ˆì´í˜ì´ì§€</h2>
                                        <p className="text-gray-500 text-center mb-6">
                                            ë§ˆì´í˜ì´ì§€ ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.<br />
                                            ê³§ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                                        </p>
                                        <button onClick={() => setScreen('result')} className="px-6 py-3 bg-[#3182F6] text-white rounded-xl shadow-lg active:scale-95 transition font-bold">
                                            ìì‚° ìˆ˜ëª… ë¶„ì„ ë³´ê¸°
                                        </button>
                                    </div>
                                )}
                            </div>

                            {/* í•˜ë‹¨ ê³ ì • íƒ­ë°” (absolute bottom-0) */}
                            <div className="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 z-30 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
                                <div className="flex justify-around items-center py-2 px-2 pb-5">
                                    <button onClick={() => setHomeTab('home')} className={`flex flex-col items-center justify-center min-w-[60px] py-2 transition ${homeTab === 'home' ? 'text-[#3182F6]' : 'text-gray-400'}`}>
                                        <div className="mb-1 text-2xl">ğŸ </div>
                                        <span className="text-[10px] font-bold">í™ˆ</span>
                                    </button>

                                    <button onClick={() => setHomeTab('analysis')} className={`flex flex-col items-center justify-center min-w-[60px] py-2 transition ${homeTab === 'analysis' ? 'text-[#3182F6]' : 'text-gray-400'}`}>
                                        <div className="mb-1">
                                            <Icon d={Icons.Graph} size={24} />
                                        </div>
                                        <span className="text-[10px] font-bold">ë¶„ì„</span>
                                    </button>

                                    <button onClick={() => setHomeTab('ledger')} className={`flex flex-col items-center justify-center min-w-[60px] py-2 transition ${homeTab === 'ledger' ? 'text-[#3182F6]' : 'text-gray-400'}`}>
                                        <div className="mb-1">
                                            <Icon d={Icons.Piggy} size={24} />
                                        </div>
                                        <span className="text-[10px] font-bold">ê°€ê³„ë¶€</span>
                                    </button>

                                    <button onClick={() => setHomeTab('report')} className={`flex flex-col items-center justify-center min-w-[60px] py-2 transition ${homeTab === 'report' ? 'text-[#3182F6]' : 'text-gray-400'}`}>
                                        <div className="mb-1">
                                            <Icon d={Icons.Activity} size={24} />
                                        </div>
                                        <span className="text-[10px] font-bold">ë¦¬í¬íŠ¸</span>
                                    </button>

                                    <button onClick={() => setHomeTab('my')} className={`flex flex-col items-center justify-center min-w-[60px] py-2 transition ${homeTab === 'my' ? 'text-[#3182F6]' : 'text-gray-400'}`}>
                                        <div className="mb-1 text-2xl">ğŸ‘¤</div>
                                        <span className="text-[10px] font-bold">ë§ˆì´</span>
                                    </button>
                                </div>
                            </div>

                        </div>
                    )}

                    {/* --- [íšŒì›ê°€ì… í˜ì´ì§€] --- */}
                    {screen === 'signup' && (
                        <div className="flex-1 flex flex-col bg-white animate-fade-in relative overflow-y-auto hide-scrollbar">
                            <div className="flex items-center p-4">
                                <button onClick={()=>setScreen('result')} className="text-gray-400 hover:text-gray-800"><Icon d={Icons.ArrowLeft} /></button>
                            </div>

                            <div className="px-6 mb-4 text-center">
                                <h2 className="text-2xl font-bold text-gray-900 leading-snug">
                                    <span className="text-[#3182F6]">LifePort</span>ë¡œ ì«Œ ì‰½ê²Œ.<br/>
                                    ìì‚° ìˆ˜ëª… ê´€ë¦¬í•´ìš”
                                </h2>
                            </div>

                            <div className="px-6 flex flex-col items-center mb-6">
                                <div className="w-full bg-gray-50 rounded-[32px] p-6 shadow-sm border border-gray-100 flex flex-col items-center relative overflow-hidden">
                                    <div className="bg-[#E8F3FF] text-[#3182F6] text-[10px] font-bold px-2 py-1 rounded-full mb-4">ë‚´ ìì‚° ìˆ˜ëª…ì€ ì–¼ë§ˆ?</div>
                                    <div className="text-center mb-6">
                                        <div className="text-gray-500 text-xs mb-1">{inputData.age}ì„¸ {jobTraits[inputData.jobType].title}ë‹˜ì˜ ì˜ˆìƒ ê²°ê³¼</div>
                                        <div className="text-2xl font-bold text-gray-800">{simulationResult.isBankrupt ? `${simulationResult.bankruptAge}ì„¸ì—` : '100ì„¸+'} ìì‚° ì†Œì§„!</div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3 w-full">
                                        <div className="bg-white p-4 rounded-2xl border border-gray-100 flex flex-col items-center gap-2 shadow-sm"><span className="text-xs text-gray-500">ë¶€ì¡± ìê¸ˆ</span><Icon d={Icons.Graph} className="text-red-400" /></div>
                                        <div className="bg-white p-4 rounded-2xl border border-gray-100 flex flex-col items-center gap-2 shadow-sm"><span className="text-xs text-gray-500">ë§ì¶¤ ì†”ë£¨ì…˜</span><Icon d={Icons.Shield} className="text-blue-400" /></div>
                                    </div>
                                </div>
                            </div>

                            <div className="px-6 space-y-4 pb-8">
                                <div className="input-group">
                                    <label>ì´ë¦„</label>
                                    <input type="text" name="name" value={signupForm.name} onChange={handleSignupInput} placeholder="ì‹¤ëª… ì…ë ¥" />
                                </div>
                                <div className="input-group">
                                    <label>ì•„ì´ë”” (ì´ë©”ì¼)</label>
                                    <input type="email" name="id" value={signupForm.id} onChange={handleSignupInput} placeholder="example@email.com" />
                                </div>
                                <div className="input-group">
                                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" name="password" value={signupForm.password} onChange={handleSignupInput} placeholder="6ìë¦¬ ì´ìƒ" />
                                </div>
                            </div>
                            
                            <div className="p-6 pt-0 bg-white mt-auto">
                                <button onClick={completeSignup} className="w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold text-lg active:scale-95 transition shadow-lg mb-3">
                                    ê°€ì… ì™„ë£Œí•˜ê³  ê²°ê³¼ ë³´ê¸°
                                </button>
                                <div className="text-center text-xs text-gray-400">
                                    ë¡œê·¸ì¸ ì‹œ ì´ìš©ì•½ê´€ ë° ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- [ìƒí’ˆ ì¶”ì²œ í˜ì´ì§€] --- */}
                    {screen === 'product' && selectedProductType && (
                        <div className="flex-1 flex flex-col bg-white animate-fade-in relative overflow-hidden">
                            <div className="flex items-center p-4 border-b border-gray-100 sticky top-0 bg-white z-20">
                                <button onClick={() => setScreen('result')} className="p-2 -ml-2 text-gray-800 hover:bg-gray-100 rounded-full"><Icon d={Icons.ArrowLeft} size={24} /></button>
                                <h2 className="text-lg font-bold ml-2">{PRODUCT_DATA[selectedProductType].title}</h2>
                            </div>
                            <div className="p-6 bg-gray-50 border-b border-gray-100">
                                <h3 className="text-xl font-bold text-gray-800 mb-1">{PRODUCT_DATA[selectedProductType].desc}</h3>
                                <p className="text-sm text-gray-500">LifePortê°€ ì—„ì„ í•œ ì´ë‹¬ì˜ ìƒí’ˆì…ë‹ˆë‹¤.</p>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 pb-20 hide-scrollbar relative">
                                {PRODUCT_DATA[selectedProductType].items.map((item) => (
                                    <div key={item.id} className={`p-5 rounded-2xl border transition hover:shadow-md cursor-pointer ${item.highlight ? 'border-[#3182F6] bg-blue-50/30' : 'border-gray-200 bg-white'}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div className="flex items-center gap-2"><span className="px-2 py-1 rounded text-[10px] font-bold bg-gray-100 text-gray-600">{item.tag}</span>{item.highlight && <span className="text-[10px] font-bold text-[#3182F6]">ì¶”ì²œ</span>}</div>
                                            <button className="text-gray-400"><Icon d={Icons.ArrowRight} size={16} /></button>
                                        </div>
                                        <h4 className="font-bold text-gray-800 text-lg mb-1">{item.name}</h4>
                                        <div className="text-sm text-gray-500 mb-4">{item.bank || item.company}</div>
                                        <div className="flex justify-between items-end">
                                            <div><div className="text-xs text-gray-400">{item.period || 'ê¸ˆë¦¬/ìˆ˜ìµë¥ '}</div><div className="text-xl font-bold text-[#3182F6]">{item.rate || item.info}</div></div>
                                            <button className={`px-4 py-2 rounded-lg text-sm font-bold ${item.highlight ? 'bg-[#3182F6] text-white' : 'bg-gray-100 text-gray-600'}`}>ê°€ì…í•˜ê¸°</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* --- [ë§ˆì´ë°ì´í„° ë“± ê¸°íƒ€ í™”ë©´ (ê¸°ì¡´ ìœ ì§€)] --- */}
                    {screen === 'mydata' && (
                         <div className="flex-1 flex flex-col bg-white animate-fade-in relative overflow-hidden">
                            <div className="flex items-center p-4 border-b border-gray-100">
                                {myDataStep === 'select' && (
                                    <button onClick={() => setScreen('input')} className="p-2 -ml-2 text-gray-500"><Icon d={Icons.X} size={24} /></button>
                                )}
                                <h2 className="text-lg font-bold ml-2 flex-1 text-center pr-8">
                                    {myDataStep === 'select' ? 'ì—°ê²°í•  ê³„ì¢Œ ì„ íƒ' : (myDataStep === 'complete' ? 'ë¶„ì„ ì™„ë£Œ' : 'ê³„ì¢Œ ì—°ê²°')}
                                </h2>
                            </div>
                            {myDataStep === 'select' && (
                                <div className="flex-1 overflow-y-auto p-6 pb-32 hide-scrollbar relative">
                                    <p className="text-gray-500 mb-6">ìì‚° ìˆ˜ëª… ê³„ì‚°ì— ì‚¬ìš©í• <br/>ë‚´ ëª…ì˜ ê³„ì¢Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                                    <div className="space-y-4">
                                        {mockAccounts.map(acc => (
                                            <div key={acc.id} onClick={() => toggleAccountSelection(acc.id)} className="flex items-center justify-between p-4 bg-gray-50 rounded-2xl border border-gray-100 cursor-pointer hover:bg-gray-100 transition">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-xl shadow-sm">{acc.icon}</div>
                                                    <div>
                                                        <div className="font-bold text-gray-800">{acc.bank}</div>
                                                        <div className="text-sm text-gray-500">{acc.name}</div>
                                                    </div>
                                                </div>
                                                <div className={`custom-checkbox ${selectedAccounts.includes(acc.id) ? 'checked' : ''}`}>
                                                    {selectedAccounts.includes(acc.id) && <Icon d={Icons.Check} size={16} color="white" />}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            {(myDataStep === 'connecting' || myDataStep === 'analyzing') && (
                                <div className="flex-1 flex flex-col justify-center items-center p-8">
                                    <div className="w-16 h-16 border-4 border-gray-100 border-t-[#3182F6] rounded-full animate-spin mb-8"></div>
                                    <h3 className="text-xl font-bold mb-2">{myDataStep === 'connecting' ? 'ì•ˆì „í•˜ê²Œ ì—°ê²° ì¤‘...' : 'ê±°ë˜ë‚´ì—­ ë¶„ì„ ì¤‘...'}</h3>
                                    <p className="text-gray-400 text-center">{myDataStep === 'connecting' ? 'ê¸ˆìœµê¸°ê´€ê³¼ ì•”í˜¸í™” í†µì‹ ì„ ì‹œì‘í•©ë‹ˆë‹¤.' : 'ìµœê·¼ 3ê°œì›” ì†Œë¹„ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬\nì£¼ìš” ìŠµê´€ì„ íŒŒì•…í•©ë‹ˆë‹¤.'}</p>
                                </div>
                            )}
                            {myDataStep === 'complete' && analyzedData && (
                                <div className="flex-1 flex flex-col p-8 items-center justify-center animate-fade-in pb-32 overflow-y-auto hide-scrollbar">
                                    <div className="text-6xl mb-6">ğŸ‰</div>
                                    <h2 className="text-2xl font-bold mb-2">ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                                    <p className="text-gray-500 mb-10 text-center">ë°œê²¬ëœ ìì‚°ê³¼ ì†Œë¹„ ë‚´ì—­ìœ¼ë¡œ<br/>ë” ì •í™•í•œ ì§„ë‹¨ì´ ê°€ëŠ¥í•´ì¡Œì–´ìš”.</p>
                                    <div className="w-full bg-gray-50 p-6 rounded-2xl border border-gray-100 mb-6 space-y-4">
                                        <div className="flex justify-between items-center"><span className="text-gray-500">ì´ ìˆœìì‚°</span><span className="text-xl font-bold text-[#3182F6]">{formatMoney(analyzedData.totalAssets)}</span></div>
                                        <div className="flex justify-between items-center"><span className="text-gray-500">ì›” í‰ê·  ì†Œë“</span><span className="text-xl font-bold">{analyzedData.monthlyIncome.toLocaleString()}ë§Œì›</span></div>
                                        <div className="flex justify-between items-center"><span className="text-gray-500">ì›” í‰ê·  ì§€ì¶œ</span><span className="text-xl font-bold">{analyzedData.monthlyExpense.toLocaleString()}ë§Œì›</span></div>
                                        <div className="pt-4 border-t border-gray-200">
                                            <span className="block text-sm text-gray-500 mb-2">ë‚˜ì˜ ì£¼ ì†Œë¹„ ìŠµê´€</span>
                                            <div className={`flex items-center gap-2 font-bold p-3 rounded-xl ${habitCategories[analyzedData.habit].bg} ${habitCategories[analyzedData.habit].color}`}>
                                                <Icon d={habitCategories[analyzedData.habit].icon} /><span>{habitCategories[analyzedData.habit].title}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div className="p-6 border-t border-gray-100 bg-white absolute bottom-0 w-full z-10">
                                {myDataStep === 'select' && (
                                    <button onClick={proceedToConnection} disabled={selectedAccounts.length === 0} className={`w-full py-4 rounded-xl font-bold transition ${selectedAccounts.length > 0 ? 'bg-[#3182F6] text-white active:scale-95' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>
                                        {selectedAccounts.length}ê°œ ê³„ì¢Œ ì—°ê²°í•˜ê¸°
                                    </button>
                                )}
                                {myDataStep === 'complete' && (
                                    <button onClick={applyMyDataResult} className="w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg">
                                        ì´ ë°ì´í„°ë¡œ ë¶„ì„ ì‹œì‘í•˜ê¸°
                                    </button>
                                )}
                            </div>
                        </div>
                    )}

                    {/* INTRO */}
                    {screen === 'intro' && (
                        <div className="flex-1 flex flex-col justify-center text-center p-8 animate-fade-in">
                            <div className="text-6xl mb-6 animate-bounce">ğŸª™</div>
                            <h1 className="text-2xl font-bold mb-4">ë‹¹ì‹ ì˜ ëˆì€<br/>ì–¸ì œ ì£½ì„ê¹Œìš”?</h1>
                            <p className="text-gray-400 mb-10 text-sm">í˜„ì¬ ì†Œë“ê³¼ ì§€ì¶œì„ ì…ë ¥í•˜ë©´<br/>ê¸ˆìœµ ìˆ˜ëª…ì„ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.<br/>(ë¬¼ê°€ìƒìŠ¹/ì„¸ê¸ˆ í˜„ì‹¤í™” ë²„ì „)</p>
                            <button onClick={()=>setScreen('input')} className="w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg">ë‚´ ë°ì´í„° ì…ë ¥í•˜ê¸°</button>
                        </div>
                    )}

                    {/* INPUT FORM */}
                    {screen === 'input' && (
                         <div className="flex-1 flex flex-col p-6 animate-fade-in bg-white overflow-y-auto">
                            <div className="flex items-center gap-2 mb-6">
                                <button onClick={()=>setScreen('intro')} className="text-gray-400 hover:text-gray-800"><Icon d="M19 12H5M12 19l-7-7 7-7" /></button>
                                <h2 className="text-xl font-bold">ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
                            </div>
                            
                            {!analyzedData ? (
                                <button onClick={startMyDataFlow} className="w-full py-3 mb-8 rounded-xl border border-gray-200 bg-gray-50 text-gray-600 font-bold text-sm flex items-center justify-center gap-2 hover:bg-gray-100 transition relative overflow-hidden group">
                                    <span className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"></span>
                                    <Icon d={Icons.Link} size={16} className="text-[#3182F6]" /> <span>ë‚´ ìì‚° ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° (MVP)</span>
                                </button>
                            ) : (
                                <div className="w-full py-3 mb-8 rounded-xl border border-[#3182F6]/30 bg-[#3182F6]/10 text-[#3182F6] font-bold text-sm flex items-center justify-center gap-2">
                                    <Icon d={Icons.Check} size={16} /> <span>ë‚´ ìì‚° ë°ì´í„° ì—°ë™ ì™„ë£Œ!</span>
                                </div>
                            )}

                            <div className="space-y-6">
                                <div className="input-group"><label>ë‚˜ì´ (ì„¸)</label><input type="number" name="age" value={inputData.age} onChange={handleInputChange} /></div>
                                <div className="input-group"><label>ì§ì—…êµ°</label><select name="jobType" value={inputData.jobType} onChange={handleInputChange}><option value="office">ì§ì¥ì¸</option><option value="civil">ê³µë¬´ì›/ê³µê¸°ì—…</option><option value="free">í”„ë¦¬ëœì„œ</option><option value="startup">ì‚¬ì—…ê°€/ìì˜ì—…</option><option value="pro">ì „ë¬¸ì§</option></select></div>
                                <div className="input-group"><label>ì›” í‰ê·  ì„¸í›„ ì†Œë“ (ë§Œì›)</label><input type="number" name="monthlyIncome" value={inputData.monthlyIncome} onChange={handleInputChange} className={analyzedData ? "bg-blue-50/50 font-bold text-[#3182F6]" : ""} /></div>
                                <div className="input-group"><label>í˜„ì¬ ìˆœìì‚° (ë¶€ì±„ ì œì™¸, ë§Œì›)</label><input type="number" name="totalAssets" value={inputData.totalAssets} onChange={handleInputChange} placeholder={analyzedData ? "" : "ì˜ˆ: 5000"} className={analyzedData ? "bg-blue-50/50 font-bold text-[#3182F6]" : ""} /></div>
                                <div className="input-group"><label>ì›” í‰ê·  ì§€ì¶œ (ìˆ¨ë§Œ ì‰¬ì–´ë„ ë‚˜ê°€ëŠ” ëˆ í¬í•¨)</label><input type="number" name="monthlyExpense" value={inputData.monthlyExpense} onChange={handleInputChange} className={analyzedData ? "bg-blue-50/50 font-bold text-[#3182F6]" : ""} /></div>
                            </div>
                            <button onClick={startAnalysis} className="mt-10 w-full py-4 rounded-xl bg-[#3182F6] text-white font-bold active:scale-95 transition shadow-lg flex items-center justify-center gap-2"><span>ë¶„ì„ ì‹œì‘í•˜ê¸°</span> <Icon d={Icons.ArrowRight} size={18} /></button>
                        </div>
                    )}

                    {/* LOADING */}
                    {screen === 'loading' && (
                        <div className="flex-1 flex flex-col justify-center items-center p-8 animate-fade-in">
                            <div className="w-12 h-12 border-4 border-gray-100 border-t-[#3182F6] rounded-full animate-spin mb-8"></div>
                            <div className="text-lg font-bold mb-2">ì •ë°€ ë¶„ì„ ì¤‘...</div>
                            {analyzedData && <div className="text-sm text-[#3182F6] font-bold mb-1">âœ¨ ì—°ë™ëœ ê¸ˆìœµ ë°ì´í„° ë°˜ì˜ë¨</div>}
                            <div className="text-sm text-gray-400 mb-10">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</div>
                            <div className="w-full space-y-4">
                                <div className={`flex items-center gap-3 ${loadingStep>=1?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Bank} /> <span>ë¬¼ê°€ìƒìŠ¹ë¥  ë°˜ì˜ ì¤‘</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=2?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Card} /> <span>ì„¸ê¸ˆ ë° ê³µì œ í•­ëª© ê³„ì‚°</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=3?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Activity} /> <span>ìƒì•  ì£¼ê¸° ë¦¬ìŠ¤í¬ ì ìš©</span></div>
                                <div className={`flex items-center gap-3 ${loadingStep>=4?'text-gray-800':'text-gray-300'}`}><Icon d={Icons.Graph} /> <span>ìµœì¢… ê¸ˆìœµ ìˆ˜ëª… ì˜ˆì¸¡</span></div>
                            </div>
                        </div>
                    )}

                    {/* RESULT */}
                    {screen === 'result' && profile && simulationResult && (
                        <div ref={resultContainerRef} className="flex-1 overflow-y-auto hide-scrollbar pb-10 animate-fade-in relative bg-white">
                            
                            <div className="sticky top-0 bg-white z-20 p-6 pb-2 border-b border-gray-50 shadow-sm">
                                {/* [ì¶”ê°€] í™ˆìœ¼ë¡œ ì´ë™ ë²„íŠ¼ */}
                                <button 
                                    onClick={() => setScreen(isLoggedIn ? 'home' : 'intro')}
                                    className="absolute left-4 top-4 p-2 text-gray-400 hover:text-gray-800 hover:bg-gray-100 rounded-full transition z-30"
                                    aria-label="í™ˆìœ¼ë¡œ ì´ë™"
                                >
                                    <Icon d={Icons.Home} size={22} />
                                </button>

                                <div className="flex justify-center mb-4 relative pt-2">
                                    <span className="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full font-bold flex items-center gap-1"><Icon d={Icons.User} size={14}/> {profile.age}ì„¸ Â· {profile.job}</span>
                                    {profile.habit && (
                                        <div className={`absolute right-0 top-[-10px] flex items-center gap-1 px-2 py-1 rounded-full text-[10px] font-bold border ${habitCategories[profile.habit].bg} ${habitCategories[profile.habit].color} border-current`}>
                                            <Icon d={habitCategories[profile.habit].icon} size={12} /> {habitCategories[profile.habit].title}
                                        </div>
                                    )}
                                </div>
                                <div className="text-center mb-4">
                                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold mb-2 ${getStatus(simulationResult.bankruptAge).bg} ${getStatus(simulationResult.bankruptAge).color}`}>{getStatus(simulationResult.bankruptAge).msg}</span>
                                    <div className="text-3xl font-extrabold leading-tight text-gray-900">
                                        ë‹¹ì‹ ì˜ ëˆì€<br/>
                                        <span className={getStatus(simulationResult.bankruptAge).color}>
                                            {simulationResult.isBankrupt ? `${simulationResult.bankruptAge}ì„¸` : '100ì„¸+'}
                                        </span>ì— ì‚¬ë§í•©ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </div>

                            <div className="relative">
                                {!isLoggedIn && (
                                    <div className="lock-overlay-container">
                                        <div className="lock-overlay-content bg-white p-6 rounded-3xl shadow-xl border border-gray-100 flex flex-col items-center text-center max-w-[85%] mx-auto z-50 animate-fade-in">
                                            <div className="text-4xl mb-4">ğŸ”</div>
                                            <h3 className="text-lg font-bold mb-2 text-gray-900">ì •í™•í•œ ì†”ë£¨ì…˜ì´ ì ê²¨ìˆì–´ìš”</h3>
                                            <p className="text-gray-500 text-sm mb-6 leading-relaxed">
                                                ë¬´ë£Œ íšŒì›ê°€ì…ìœ¼ë¡œ<br/>
                                                <span className="font-bold text-gray-700">ë‚¨ì€ ìì‚° ìˆ˜ëª…</span>ì„ ëŠ˜ë ¤ë³´ì„¸ìš”.
                                            </p>
                                            <button 
                                                onClick={goToSignup}
                                                className="w-full py-4 bg-[#3182F6] text-white rounded-xl font-bold mb-3 shadow-sm hover:shadow-md transition active:scale-95"
                                            >
                                                íšŒì›ê°€ì…í•˜ê³  ê²°ê³¼ ë³´ê¸°
                                            </button>
                                        </div>
                                    </div>
                                )}

                                <div className={!isLoggedIn ? 'blur-gradient-mask' : ''}>
                                    <div className={!isLoggedIn ? 'content-blurred' : ''}>
                                        <div className="px-6 mt-6">
                                            <div className="flex justify-center gap-2 mb-6">
                                                {['basic','standard','rich'].map(l => (
                                                    <button key={l} onClick={()=>setLifestyle(l)} className={`px-4 py-2 rounded-full text-xs font-bold border transition ${lifestyle===l?'bg-[#191F28] text-white border-[#191F28]':'bg-white text-gray-500 hover:bg-gray-50'}`}>{l==='basic'?'ì ˆì•½':l==='standard'?'ë³´í†µ':'ì—¬ìœ '}</button>
                                                ))}
                                            </div>
                                            <div className="mb-2">
                                                <div className="flex justify-between text-xs font-bold text-gray-500 mb-2"><span>ğŸ’¸ ìì‚° ìˆ˜ëª…</span><span>{simulationResult.bankruptAge}ì„¸</span></div>
                                                <div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                                                    <div className={`h-full transition-all duration-700 ${getStatus(simulationResult.bankruptAge).bar}`} style={{width:`${Math.min(100, simulationResult.bankruptAge)}%`}}></div>
                                                </div>
                                                <p className="text-center text-[10px] text-gray-400 mt-2">â–² ì¸í”Œë ˆì´ì…˜ 3%, ì„¸ê¸ˆ 15.4% ë°˜ì˜</p>
                                            </div>
                                        </div>

                                        <div className="p-6">
                                            <div className="flex items-center gap-2 text-lg font-bold mb-4"><Icon d={Icons.Alert} color="#FF8D4D" /> <span>{Math.floor(profile.age/10)*10}ëŒ€ ë¼ì´í”„ ë¦¬ìŠ¤í¬</span></div>
                                            {profile.risks.map(r => (
                                                <div key={r.id} onClick={() => toggleRisk(r.id)} className="bg-white border border-gray-100 p-4 rounded-2xl mb-3 shadow-sm cursor-pointer hover:bg-gray-50 transition-colors relative">
                                                    <div className="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded inline-block mb-2">âš ï¸ ìœ„í—˜ë„ {r.prob}</div>
                                                    <div className="flex justify-between items-center mb-1">
                                                        <span className="font-bold text-gray-800">{r.title}</span>
                                                        <div className={`w-11 h-6 rounded-full relative transition-colors ${activeRisks[r.id] ? 'bg-[#FF8D4D]' : 'bg-gray-200'}`}>
                                                            <div className={`absolute top-[2px] left-[2px] bg-white border border-gray-300 rounded-full h-5 w-5 transition-transform ${activeRisks[r.id] ? 'translate-x-full border-white' : ''}`}></div>
                                                        </div>
                                                    </div>
                                                    <div className="flex justify-between text-xs text-gray-500"><span>ì˜ˆìƒ ì†ì‹¤ì•¡</span><span className="text-[#E94658] font-bold">-{formatMoney(r.loss)}</span></div>
                                                </div>
                                            ))}
                                        </div>
                                        
                                        <div className="p-6 bg-gray-50 border-t border-gray-100">
                                            <div className="flex items-center gap-2 text-lg font-bold mb-4 text-gray-800"><Icon d={Icons.Shield} color="#3182F6" /> <span>ì†”ë£¨ì…˜ ì‹œë®¬ë ˆì´í„°</span></div>
                                            
                                            <div className="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm mb-6">
                                                <div className="text-sm font-bold text-[#3182F6] mb-1">â˜•ï¸ ì›” ì €ì¶•ì„ ëŠ˜ë¦°ë‹¤ë©´?</div>
                                                <div className="text-xs text-gray-500 mb-4 bg-gray-50 px-3 py-2 rounded-lg">
                                                    {profile.age}ì„¸ ë˜ë˜ë“¤ì€ í‰ê·  <span className="font-bold text-gray-700">ì›” {getPeerAvgSavings(profile.age)}ë§Œì›</span>ì„ ì €ì¶•í•´ìš”.
                                                </div>

                                                <input type="range" min="0" max="300" step="10" value={savings} onChange={(e)=>setSavings(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mb-2" style={{background: `linear-gradient(to right, #3182F6 ${(savings/300)*100}%, #e5e7eb ${(savings/300)*100}%)`}}/>
                                                <div className="flex justify-between items-center mb-6"><span className="text-xs text-gray-500">ì¶”ê°€ ì €ì¶•ì•¡</span><span className="text-lg font-bold text-[#3182F6]">{savings}ë§Œì›</span></div>
                                                
                                                {savings > 0 ? (
                                                    <div className="animate-fade-in">
                                                        {(() => {
                                                            const portfolio = getPortfolioSuggestion(profile.age, savings);
                                                            return (
                                                                <>
                                                                    <div className="text-xs font-bold text-gray-800 mb-3 flex items-center gap-1">
                                                                        <Icon d={Icons.Piggy} size={14} className="text-[#3182F6]"/> 
                                                                        <span>ì¶”ì²œ í¬íŠ¸í´ë¦¬ì˜¤ ({portfolio.type})</span>
                                                                    </div>
                                                                    <div className="space-y-2">
                                                                        {portfolio.items.map((item) => (
                                                                            <div key={item.id} className="flex items-center text-xs">
                                                                                <div className={`w-2 h-2 rounded-full ${item.color} mr-2`}></div>
                                                                                <span className="text-gray-500 w-16">{item.name}</span>
                                                                                <span className="text-gray-400 w-10 text-right mr-2">{item.ratio}%</span>
                                                                                <span className="font-bold text-gray-800 flex-1 text-right">{item.amount.toLocaleString()}ë§Œì›</span>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </>
                                                            );
                                                        })()}

                                                        <div className="mt-6 pt-5 border-t border-dashed border-gray-200">
                                                            <div className="text-[11px] text-center text-gray-400 mb-3">ğŸ‘‡ ì´ ë¹„ìœ¨ë¡œ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ìƒí’ˆ ë³´ê¸°</div>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                <button onClick={()=>handleProductClick('deposit')} className="flex flex-col items-center justify-center p-2 bg-blue-50 rounded-xl hover:bg-blue-100 transition">
                                                                    <span className="text-xl mb-1">ğŸ¦</span>
                                                                    <span className="text-[10px] font-bold text-blue-600">ì˜ˆ/ì ê¸ˆ</span>
                                                                </button>
                                                                <button onClick={()=>handleProductClick('etf')} className="flex flex-col items-center justify-center p-2 bg-purple-50 rounded-xl hover:bg-purple-100 transition">
                                                                    <span className="text-xl mb-1">ğŸ“ˆ</span>
                                                                    <span className="text-[10px] font-bold text-purple-600">ETF/í€ë“œ</span>
                                                                </button>
                                                                <button onClick={()=>handleProductClick('pension')} className="flex flex-col items-center justify-center p-2 bg-green-50 rounded-xl hover:bg-green-100 transition">
                                                                    <span className="text-xl mb-1">ğŸ›¡ï¸</span>
                                                                    <span className="text-[10px] font-bold text-green-600">ì—°ê¸ˆë³´í—˜</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center text-xs text-gray-400 py-4 bg-gray-50 rounded-xl">
                                                        ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬<br/>ì €ì¶• í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="bg-[#E8F3FF] p-5 rounded-2xl mb-6">
                                                <div className="flex items-start gap-3">
                                                    <div className="bg-white p-2 rounded-full text-[#3182F6]"><Icon d={Icons.Bell} /></div>
                                                    <div>
                                                        <h3 className="font-bold text-[#3182F6] text-sm mb-1">ë§¤ì£¼ ë¦¬í¬íŠ¸ ë°›ê¸°</h3>
                                                        <p className="text-xs text-gray-600 mb-3">ë³€ë™ë˜ëŠ” ìì‚° ìˆ˜ëª…ì„<br/>ë§¤ì£¼ ì•Œë¦¼ìœ¼ë¡œ ì²´í¬í•˜ì„¸ìš”.</p>
                                                        <button onClick={handleSubscribe} disabled={isSubscribed} className={`w-full py-3 rounded-xl text-sm font-bold transition ${isSubscribed ? 'bg-gray-400 text-white cursor-default' : 'bg-[#3182F6] text-white active:scale-95 shadow-md'}`}>{isSubscribed ? 'êµ¬ë… ì¤‘' : 'êµ¬ë…í•˜ê¸°'}</button>
                                                    </div>
                                                </div>
                                            </div>

                                            <button onClick={resetAll} className="w-full py-4 bg-white text-gray-600 border border-gray-200 rounded-xl font-bold flex justify-center items-center gap-2 shadow-sm active:scale-95 transition hover:bg-gray-50"><Icon d={Icons.Refresh} /> <span>ë‹¤ì‹œ ì…ë ¥í•˜ê¸°</span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LifePortSimulator />);
    </script>
</body>
</html>
